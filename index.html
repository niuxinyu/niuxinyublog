<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/niuxinyublog/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/niuxinyublog/images/favicon-32x32-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/niuxinyublog/images/favicon-16x16-next.png?v=7.4.0">
  <link rel="mask-icon" href="/niuxinyublog/images/logo.svg?v=7.4.0" color="#222">

<link rel="stylesheet" href="/niuxinyublog/css/main.css?v=7.4.0">


<link rel="stylesheet" href="/niuxinyublog/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/niuxinyublog/',
    scheme: 'Gemini',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="文章">
<meta property="og:type" content="website">
<meta property="og:title" content="niu的blog">
<meta property="og:url" content="https://niuxinyu.github.io/niuxinyublog/index.html">
<meta property="og:site_name" content="niu的blog">
<meta property="og:description" content="文章">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="niu的blog">
<meta name="twitter:description" content="文章">
  <link rel="canonical" href="https://niuxinyu.github.io/niuxinyublog/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false,
    isPage: false,
    isArchive: false
  };
</script>

  <title>niu的blog</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/niuxinyublog/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">niu的blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/niuxinyublog/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/niuxinyublog/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            
  <div id="posts" class="posts-expand">
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://niuxinyu.github.io/niuxinyublog/niuxinyublog/2020/06/27/4W字长文带你深度解锁Webpack系列-下/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Niu">
      <meta itemprop="description" content="文章">
      <meta itemprop="image" content="/niuxinyublog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niu的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/niuxinyublog/2020/06/27/4W字长文带你深度解锁Webpack系列-下/" class="post-title-link" itemprop="url">4W字长文带你深度解锁Webpack系列(下)</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2020-06-27 22:20:34 / 修改时间：22:28:42" itemprop="dateCreated datePublished" datetime="2020-06-27T22:20:34+08:00">2020-06-27</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="4W字长文带你深度解锁Webpack系列-下"><a href="#4W字长文带你深度解锁Webpack系列-下" class="headerlink" title="4W字长文带你深度解锁Webpack系列(下)"></a>4W字长文带你深度解锁Webpack系列(下)</h1><p><a href="https://juejin.im/post/5e5c65fc6fb9a07cd00d8838" target="_blank" rel="noopener">带你深度解锁Webpack系列(基础篇)</a> 和 <a href="https://juejin.im/post/5e6518946fb9a07c820fbaaf" target="_blank" rel="noopener">带你深度解锁Webpack系列(进阶篇)</a>，主要是讲解了 <code>Webpack</code> 的配置，但是随着项目越来越大，构建速度可能会越来越慢，构建出来的js的体积也越来越大，此时就需要对 <code>Webpack</code> 的配置进行优化。</p>
<p>本文罗列出了十多种优化方式，大家可以结合自己的项目，选择适当的方式进行优化。这些 <code>Webpack</code> 插件的源码我大多也没有看过，主要是结合 <code>Webpack</code> 官方文档以及项目实践，并且花了大量的时间验证后输出了本文，如果文中有错误的地方，欢迎在评论区指正。</p>
<p>鉴于前端技术变更迅速，祭出本篇文章基于 <code>Webpack</code> 的版本号:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">├── webpack@4.41.5 </span><br><span class="line">└── webpack-cli@3.3.10</span><br></pre></td></tr></table></figure>

<p>本文对应的项目地址(编写本文时使用)供参考：<a href="https://github.com/YvetteLau/webpack/tree/master/webpack-optimize" target="_blank" rel="noopener">github.com/YvetteLau/w…</a></p>
<p><img src="https://raw.githubusercontent.com/niuxinyu/image/master/%E8%80%81%E5%8F%B8%E6%9C%BA.webp" alt="img"></p>
<h3 id="量化"><a href="#量化" class="headerlink" title="量化"></a>量化</h3><p>有时，我们以为的优化是负优化，这时，如果有一个量化的指标可以看出前后对比，那将会是再好不过的一件事。</p>
<p><code>speed-measure-webpack-plugin</code> 插件可以测量各个插件和<code>loader</code>所花费的时间，使用之后，构建时，会得到类似下面这样的信息：</p>
<p><img src="https://raw.githubusercontent.com/niuxinyu/image/master/speed-measure-webpack-plugin.webp" alt="img"></p>
<p>对比前后的信息，来确定优化的效果。</p>
<p><a href="https://www.npmjs.com/package/speed-measure-webpack-plugin" target="_blank" rel="noopener">speed-measure-webpack-plugin</a> 的使用很简单，可以直接用其来包裹 <code>Webpack</code> 的配置:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> SpeedMeasurePlugin = <span class="built_in">require</span>(<span class="string">"speed-measure-webpack-plugin"</span>);</span><br><span class="line"><span class="keyword">const</span> smp = <span class="keyword">new</span> SpeedMeasurePlugin();</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> config = &#123;</span><br><span class="line">    <span class="comment">//...webpack配置</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = smp.wrap(config);</span><br></pre></td></tr></table></figure>

<h3 id="1-exclude-include"><a href="#1-exclude-include" class="headerlink" title="1.exclude/include"></a>1.exclude/include</h3><p>我们可以通过 <code>exclude</code>、<code>include</code> 配置来确保转译尽可能少的文件。顾名思义，<code>exclude</code> 指定要排除的文件，<code>include</code> 指定要包含的文件。</p>
<p><code>exclude</code> 的优先级高于 <code>include</code>，在 <code>include</code> 和 <code>exclude</code> 中使用绝对路径数组，尽量避免 <code>exclude</code>，更倾向于使用 <code>include</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js[x]?$/</span>,</span><br><span class="line">                use: [<span class="string">'babel-loader'</span>],</span><br><span class="line">                include: [path.resolve(__dirname, <span class="string">'src'</span>)]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下图是我未配置 <code>include</code> 和配置了 <code>include</code> 的构建结果对比：</p>
<p><img src="https://raw.githubusercontent.com/niuxinyu/image/master/%E6%8C%87%E5%AE%9Ainclude%E5%92%8C%E4%B8%8D%E6%8C%87%E5%AE%9Ainclude%E7%9A%84%E5%8C%BA%E5%88%AB-4W%E5%AD%97%E4%BA%86%E8%A7%A3webpack(%E4%B8%8B).webp" alt="img"></p>
<h3 id="2-cache-loader"><a href="#2-cache-loader" class="headerlink" title="2. cache-loader"></a>2. cache-loader</h3><p>在一些性能开销较大的 <code>loader</code> 之前添加 <code>cache-loader</code>，将结果缓存中磁盘中。默认保存在 <code>node_modueles/.cache/cache-loader</code> 目录下。</p>
<p>首先安装依赖：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install cache-loader -D</span><br></pre></td></tr></table></figure>

<p><code>cache-loader</code> 的配置很简单，放在其他 <code>loader</code> 之前即可。修改<code>Webpack</code> 的配置如下:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        <span class="comment">//我的项目中,babel-loader耗时比较长，所以我给它配置了`cache-loader`</span></span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">                use: [<span class="string">'cache-loader'</span>,<span class="string">'babel-loader'</span>]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果你跟我一样，只打算给 <code>babel-loader</code> 配置 <code>cache</code> 的话，也可以不使用 <code>cache-loader</code>，给 <code>babel-loader</code> 增加选项 <code>cacheDirectory</code>。</p>
<p><img src="https://raw.githubusercontent.com/niuxinyu/image/master/%E4%B8%8D%E5%90%8C%E7%BC%93%E5%AD%98%E6%96%B9%E5%BC%8F%E7%BC%96%E8%AF%91%E5%90%8E%E5%A4%A7%E5%B0%8F-4W%E5%AD%97%E4%BA%86%E8%A7%A3webpack(%E4%B8%8B).webp" alt="img"></p>
<p><code>cacheDirectory</code>：默认值为 <code>false</code>。当有设置时，指定的目录将用来缓存 <code>loader</code> 的执行结果。之后的 <code>Webpack</code> 构建，将会尝试读取缓存，来避免在每次执行时，可能产生的、高性能消耗的 <code>Babel</code> 重新编译过程。设置空值或者 <code>true</code> 的话，使用默认缓存目录：<code>node_modules/.cache/babel-loader</code>。开启 <code>babel-loader</code>的缓存和配置 <code>cache-loader</code>，我比对了下，构建时间很接近。</p>
<h3 id="3-happypack"><a href="#3-happypack" class="headerlink" title="3.happypack"></a>3.happypack</h3><p>由于有大量文件需要解析和处理，构建是文件读写和计算密集型的操作，特别是当文件数量变多后，<code>Webpack</code> 构建慢的问题会显得严重。文件读写和计算操作是无法避免的，那能不能让 <code>Webpack</code> 同一时刻处理多个任务，发挥多核 CPU 电脑的威力，以提升构建速度呢？</p>
<p><code>HappyPack</code> 就能让 <code>Webpack</code> 做到这点，它把任务分解给多个子进程去并发的执行，子进程处理完后再把结果发送给主进程。</p>
<p>首先需要安装 <code>happypack</code>:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install happypack -D</span><br></pre></td></tr></table></figure>

<p>修改配置文件:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Happypack = <span class="built_in">require</span>(<span class="string">'happypack'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js[x]?$/</span>,</span><br><span class="line">                use: <span class="string">'Happypack/loader?id=js'</span>,</span><br><span class="line">                include: [path.resolve(__dirname, <span class="string">'src'</span>)]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                use: <span class="string">'Happypack/loader?id=css'</span>,</span><br><span class="line">                include: [</span><br><span class="line">                    path.resolve(__dirname, <span class="string">'src'</span>),</span><br><span class="line">                    path.resolve(__dirname, <span class="string">'node_modules'</span>, <span class="string">'bootstrap'</span>, <span class="string">'dist'</span>)</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> Happypack(&#123;</span><br><span class="line">            id: <span class="string">'js'</span>, <span class="comment">//和rule中的id=js对应</span></span><br><span class="line">            <span class="comment">//将之前 rule 中的 loader 在此配置</span></span><br><span class="line">            use: [<span class="string">'babel-loader'</span>] <span class="comment">//必须是数组</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> Happypack(&#123;</span><br><span class="line">            id: <span class="string">'css'</span>,<span class="comment">//和rule中的id=css对应</span></span><br><span class="line">            use: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>,<span class="string">'postcss-loader'</span>],</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>happypack</code> 默认开启 <code>CPU核数 - 1</code> 个进程，当然，我们也可以传递 <code>threads</code> 给 <code>Happypack</code>。</p>
<p><img src="https://raw.githubusercontent.com/niuxinyu/image/master/Hapypack-4W%E5%AD%97%E4%BA%86%E8%A7%A3webpack(%E4%B8%8B).webp" alt="img"></p>
<p>说明：当 <code>postcss-loader</code> 配置在 <code>Happypack</code> 中，必须要在项目中创建 <code>postcss.config.js</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//postcss.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>)()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>否则，会抛出错误: <code>Error: No PostCSS Config found</code></p>
<p>另外，当你的项目不是很复杂时，不需要配置 <code>happypack</code>，因为进程的分配和管理也需要时间，并不能有效提升构建速度，甚至会变慢。</p>
<h3 id="4-thread-loader"><a href="#4-thread-loader" class="headerlink" title="4.thread-loader"></a>4.thread-loader</h3><p>除了使用 <code>Happypack</code> 外，我们也可以使用 <code>thread-loader</code> ，把 <code>thread-loader</code> 放置在其它 <code>loader</code> 之前，那么放置在这个 <code>loader</code> 之后的 <code>loader</code> 就会在一个单独的 <code>worker</code> 池中运行。</p>
<p>在 worker 池(worker pool)中运行的 loader 是受到限制的。例如：</p>
<ul>
<li>这些 <code>loader</code> 不能产生新的文件。</li>
<li>这些 <code>loader</code> 不能使用定制的 <code>loader</code> API（也就是说，通过插件）。</li>
<li>这些 <code>loader</code> 无法获取 <code>webpack</code> 的选项设置。</li>
</ul>
<p>首先安装依赖：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install thread-loader -D</span><br></pre></td></tr></table></figure>

<p>修改配置:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        <span class="comment">//我的项目中,babel-loader耗时比较长，所以我给它配置 thread-loader</span></span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">                use: [<span class="string">'thread-loader'</span>, <span class="string">'cache-loader'</span>, <span class="string">'babel-loader'</span>]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>thread-loader</code> 和 <code>Happypack</code> 我对比了一下，构建时间基本没什么差别。不过 <code>thread-loader</code> 配置起来为简单。</p>
<h3 id="5-开启-JS-多进程压缩"><a href="#5-开启-JS-多进程压缩" class="headerlink" title="5.开启 JS 多进程压缩"></a>5.开启 JS 多进程压缩</h3><p>虽然很多 <code>webpack</code> 优化的文章上会提及多进程压缩的优化，不管是 <code>webpack-parallel-uglify-plugin</code> 或者是 <code>uglifyjs-webpack-plugin</code> 配置 <code>parallel</code>。不过这里我要说一句，没必要单独安装这些插件，它们并不会让你的 <code>Webpack</code> 构建速度提升。</p>
<p>当前 <code>Webpack</code> 默认使用的是 <code>TerserWebpackPlugin</code>，默认就开启了多进程和缓存，构建时，你的项目中可以看到 <code>terser</code> 的缓存文件 <code>node_modules/.cache/terser-webpack-plugin</code>。</p>
<h3 id="6-HardSourceWebpackPlugin"><a href="#6-HardSourceWebpackPlugin" class="headerlink" title="6.HardSourceWebpackPlugin"></a>6.HardSourceWebpackPlugin</h3><p><code>HardSourceWebpackPlugin</code> 为模块提供中间缓存，缓存默认的存放路径是: <code>node_modules/.cache/hard-source</code>。</p>
<p>配置 <code>hard-source-webpack-plugin</code>，首次构建时间没有太大变化，但是第二次开始，构建时间大约可以节约 80%。</p>
<p>首先安装依赖:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hard-source-webpack-plugin -D</span><br></pre></td></tr></table></figure>

<p>修改 <code>webpack</code> 的配置：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//webpack.config.js</span><br><span class="line">var HardSourceWebpackPlugin = require('hard-source-webpack-plugin');</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    //...</span><br><span class="line">    plugins: [</span><br><span class="line">        new HardSourceWebpackPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/niuxinyu/image/master/hard-source-webpack-plugin%E9%85%8D%E7%BD%AE-4W%E5%AD%97%E4%BA%86%E8%A7%A3webpack(%E4%B8%8B).webp" alt="img"></p>
<p>用另外一个比较大的项目测试了下，配置了 <code>HardSourceWebpackPlugin</code>，构建时间从 8S 左右降到了 2S 左右。</p>
<p><a href="https://www.npmjs.com/package/hard-source-webpack-plugin" target="_blank" rel="noopener">HardSourceWebpackPlugin文档中</a> 列出了一些你可能会遇到的问题以及如何解决，例如热更新失效，或者某些配置不生效等。</p>
<h3 id="7-noParse"><a href="#7-noParse" class="headerlink" title="7.noParse"></a>7.noParse</h3><p>如果一些第三方模块没有AMD/CommonJS规范版本，可以使用 <code>noParse</code> 来标识这个模块，这样 <code>Webpack</code> 会引入这些模块，但是不进行转化和解析，从而提升 <code>Webpack</code> 的构建性能 ，例如：<code>jquery</code> 、<code>lodash</code>。</p>
<p><a href="http://webpack.html.cn/configuration/module.html" target="_blank" rel="noopener">noParse</a> 属性的值是一个正则表达式或者是一个 <code>function</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        noParse: <span class="regexp">/jquery|lodash/</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我当前的 <code>webpack-optimize</code> 项目中，没有使用 <code>jquery</code> 或者是 <code>lodash</code>。</p>
<p>因此新建一个项目测试，只引入 <code>jquery</code> 和 <code>loadsh</code>，然后配置 <code>noParse</code> 和不配置 <code>noParse</code>，分别构建比对时间。</p>
<p>配置<code>noParse</code> 前，构建需要 <code>2392ms</code>。配置了 <code>noParse</code> 之后，构建需要 <code>1613ms</code>。 如果你使用到了不需要解析的第三方依赖，那么配置 <code>noParse</code> 很显然是一定会起到优化作用的。</p>
<h3 id="8-resolve"><a href="#8-resolve" class="headerlink" title="8.resolve"></a>8.resolve</h3><p><code>resolve</code> 配置 <code>webpack</code> 如何寻找模块所对应的文件。假设我们确定模块都从根目录下的 <code>node_modules</code> 中查找，我们可以配置:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    resolve: &#123;</span><br><span class="line">        modules: [path.resolve(__dirname, <span class="string">'node_modules'</span>)],</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要记住的是，如果你配置了上述的 <code>resolve.moudles</code> ，可能会出现问题，例如，你的依赖中还存在 <code>node_modules</code> 目录，那么就会出现，对应的文件明明在，但是却提示找不到。因此呢，个人不推荐配置这个。如果其他同事不熟悉这个配置，遇到这个问题时，会摸不着头脑。</p>
<p>另外，<code>resolve</code> 的 <code>extensions</code> 配置，默认是 <code>[&#39;.js&#39;, &#39;.json&#39;]</code>，如果你要对它进行配置，记住将频率最高的后缀放在第一位，并且控制列表的长度，以减少尝试次数。</p>
<p>本项目较小，因此测试时，此处优化效果不明显。</p>
<h3 id="9-IgnorePlugin"><a href="#9-IgnorePlugin" class="headerlink" title="9.IgnorePlugin"></a>9.IgnorePlugin</h3><p><code>webpack</code> 的内置插件，作用是忽略第三方包指定目录。</p>
<p>例如: <code>moment</code> (2.24.0版本) 会将所有本地化内容和核心功能一起打包，我们就可以使用 <code>IgnorePlugin</code> 在打包时忽略本地化内容。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">//忽略 moment 下的 ./locale 目录</span></span><br><span class="line">        <span class="keyword">new</span> webpack.IgnorePlugin(<span class="regexp">/^\.\/locale$/</span>, /moment$/)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在使用的时候，如果我们需要指定语言，那么需要我们手动的去引入语言包，例如，引入中文语言包:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> moment <span class="keyword">from</span> <span class="string">'moment'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'moment/locale/zh-cn'</span>;<span class="comment">// 手动引入</span></span><br></pre></td></tr></table></figure>

<p><code>index.js</code> 中只引入 <code>moment</code>，打包出来的 <code>bundle.js</code> 大小为 <code>263KB</code>，如果配置了 <code>IgnorePlugin</code>，单独引入 <code>moment/locale/zh-cn</code>，构建出来的包大小为 <code>55KB</code>。</p>
<h3 id="10-externals"><a href="#10-externals" class="headerlink" title="10.externals"></a>10.externals</h3><p>我们可以将一些JS文件存储在 <code>CDN</code> 上(减少 <code>Webpack</code>打包出来的 <code>js</code> 体积)，在 <code>index.html</code> 中通过 <code>&lt;script&gt;</code> 标签引入，如:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"root"</span>&gt;</span>root<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://libs.baidu.com/jquery/2.0.0/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们希望在使用时，仍然可以通过 <code>import</code> 的方式去引用(如 <code>import $ from &#39;jquery&#39;</code>)，并且希望 <code>webpack</code> 不会对其进行打包，此时就可以配置 <code>externals</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    externals: &#123;</span><br><span class="line">        <span class="comment">//jquery通过script引入之后，全局中即有了 jQuery 变量</span></span><br><span class="line">        <span class="string">'jquery'</span>: <span class="string">'jQuery'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="11-DllPlugin"><a href="#11-DllPlugin" class="headerlink" title="11.DllPlugin"></a>11.DllPlugin</h3><p>有些时候，如果所有的JS文件都打成一个JS文件，会导致最终生成的JS文件很大，这个时候，我们就要考虑拆分 <code>bundles</code>。</p>
<p><code>DllPlugin</code> 和 <code>DLLReferencePlugin</code> 可以实现拆分 <code>bundles</code>，并且可以大大提升构建速度，<code>DllPlugin</code> 和 <code>DLLReferencePlugin</code> 都是 <code>webpack</code> 的内置模块。</p>
<p>我们使用 <code>DllPlugin</code> 将不会频繁更新的库进行编译，当这些依赖的版本没有变化时，就不需要重新编译。我们新建一个 <code>webpack</code> 的配置文件，来专门用于编译动态链接库，例如名为: <code>webpack.config.dll.js</code>，这里我们将 <code>react</code> 和 <code>react-dom</code> 单独打包成一个动态链接库。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.dll.js</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        react: [<span class="string">'react'</span>, <span class="string">'react-dom'</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    mode: <span class="string">'production'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">'[name].dll.[hash:6].js'</span>,</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>, <span class="string">'dll'</span>),</span><br><span class="line">        library: <span class="string">'[name]_dll'</span> <span class="comment">//暴露给外部使用</span></span><br><span class="line">        <span class="comment">//libraryTarget 指定如何暴露内容，缺省时就是 var</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.DllPlugin(&#123;</span><br><span class="line">            <span class="comment">//name和library一致</span></span><br><span class="line">            name: <span class="string">'[name]_dll'</span>, </span><br><span class="line">            path: path.resolve(__dirname, <span class="string">'dist'</span>, <span class="string">'dll'</span>, <span class="string">'manifest.json'</span>) <span class="comment">//manifest.json的生成路径</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>package.json</code> 的 <code>scripts</code> 中增加:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"scripts"</span>: &#123;</span><br><span class="line">        <span class="string">"dev"</span>: <span class="string">"NODE_ENV=development webpack-dev-server"</span>,</span><br><span class="line">        <span class="string">"build"</span>: <span class="string">"NODE_ENV=production webpack"</span>,</span><br><span class="line">        <span class="string">"build:dll"</span>: <span class="string">"webpack --config webpack.config.dll.js"</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行 <code>npm run build:all</code>，可以看到 <code>dist</code> 目录如下，之所以将动态链接库单独放在 <code>dll</code> 目录下，主要是为了使用 <code>CleanWebpackPlugin</code> 更为方便的过滤掉动态链接库。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dist</span><br><span class="line">└── dll</span><br><span class="line">    ├── manifest.json</span><br><span class="line">    └── react.dll.9dcd9d.js</span><br></pre></td></tr></table></figure>

<p><code>manifest.json</code> 用于让 <code>DLLReferencePlugin</code> 映射到相关依赖上。</p>
<p>修改 <code>webpack</code> 的主配置文件: <code>webpack.config.js</code> 的配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        contentBase: path.resolve(__dirname, <span class="string">'dist'</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">            manifest: path.resolve(__dirname, <span class="string">'dist'</span>, <span class="string">'dll'</span>, <span class="string">'manifest.json'</span>)</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin(&#123;</span><br><span class="line">            cleanOnceBeforeBuildPatterns: [<span class="string">'**/*'</span>, <span class="string">'!dll'</span>, <span class="string">'!dll/**'</span>] <span class="comment">//不删除dll目录</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用 <code>npm run build</code> 构建，可以看到 <code>bundle.js</code> 的体积大大减少。</p>
<p>修改 <code>public/index.html</code> 文件，在其中引入 <code>react.dll.js</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"/dll/react.dll.9dcd9d.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>构建速度</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/niuxinyu/image/master/DllPlugin-4W%E5%AD%97%E4%BA%86%E8%A7%A3webpack(%E4%B8%8B).webp" alt="img"></p>
<blockquote>
<p>包体积</p>
</blockquote>
<p><img src="https://raw.githubusercontent.com/niuxinyu/image/master/DllPlugin%E5%8C%85%E4%BD%93%E7%A7%AF-4W%E5%AD%97%E4%BA%86%E8%A7%A3webpack(%E4%B8%8B).webp" alt="img"></p>
<h3 id="12-抽离公共代码"><a href="#12-抽离公共代码" class="headerlink" title="12.抽离公共代码"></a>12.抽离公共代码</h3><p>抽离公共代码是对于多页应用来说的，如果多个页面引入了一些公共模块，那么可以把这些公共的模块抽离出来，单独打包。公共代码只需要下载一次就缓存起来了，避免了重复下载。</p>
<p>抽离公共代码对于单页应用和多页应该在配置上没有什么区别，都是配置在<code>optimization.splitChunks</code> 中。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    optimization: &#123;</span><br><span class="line">        splitChunks: &#123;<span class="comment">//分割代码块</span></span><br><span class="line">            cacheGroups: &#123;</span><br><span class="line">                vendor: &#123;</span><br><span class="line">                    <span class="comment">//第三方依赖</span></span><br><span class="line">                    priority: <span class="number">1</span>, <span class="comment">//设置优先级，首先抽离第三方模块</span></span><br><span class="line">                    name: <span class="string">'vendor'</span>,</span><br><span class="line">                    test: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                    chunks: <span class="string">'initial'</span>,</span><br><span class="line">                    minSize: <span class="number">0</span>,</span><br><span class="line">                    minChunks: <span class="number">1</span> <span class="comment">//最少引入了1次</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">//缓存组</span></span><br><span class="line">                common: &#123;</span><br><span class="line">                    <span class="comment">//公共模块</span></span><br><span class="line">                    chunks: <span class="string">'initial'</span>,</span><br><span class="line">                    name: <span class="string">'common'</span>,</span><br><span class="line">                    minSize: <span class="number">100</span>, <span class="comment">//大小超过100个字节</span></span><br><span class="line">                    minChunks: <span class="number">3</span> <span class="comment">//最少引入了3次</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>即使是单页应用，同样可以使用这个配置，例如，打包出来的 bundle.js 体积过大，我们可以将一些依赖打包成动态链接库，然后将剩下的第三方依赖拆出来。这样可以有效减小 bundle.js 的体积大小。当然，你还可以继续提取业务代码的公共模块，此处，因为我项目中源码较少，所以没有配置。</p>
<p><img src="https://raw.githubusercontent.com/niuxinyu/image/master/%E6%8A%BD%E7%A6%BB%E5%85%AC%E5%85%B1%E4%BB%A3%E7%A0%81-4W%E5%AD%97%E4%BA%86%E8%A7%A3webpack(%E4%B8%8B).webp" alt="img"></p>
<blockquote>
<p>runtimeChunk</p>
</blockquote>
<p><code>runtimeChunk</code> 的作用是将包含 <code>chunk</code> 映射关系的列表从 <code>main.js</code> 中抽离出来，在配置了 <code>splitChunk</code> 时，记得配置 <code>runtimeChunk</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    optimization: &#123;</span><br><span class="line">        runtimeChunk: &#123;</span><br><span class="line">            name: <span class="string">'manifest'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终构建出来的文件中会生成一个 <code>manifest.js</code>。</p>
<h4 id="借助-webpack-bundle-analyzer-进一步优化"><a href="#借助-webpack-bundle-analyzer-进一步优化" class="headerlink" title="借助 webpack-bundle-analyzer 进一步优化"></a>借助 webpack-bundle-analyzer 进一步优化</h4><p>在做 <code>webpack</code> 构建优化的时候，<code>vendor</code> 打出来超过了1M，<code>react</code> 和 <code>react-dom</code> 已经打包成了DLL。</p>
<p>因此需要借助 <code>webpack-bundle-analyzer</code> 查看一下是哪些包的体积较大。</p>
<p>首先安装依赖：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-bundle-analyzer -D</span><br></pre></td></tr></table></figure>

<p>使用也很简单，修改下我们的配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.prod.js</span></span><br><span class="line"><span class="keyword">const</span> BundleAnalyzerPlugin = <span class="built_in">require</span>(<span class="string">'webpack-bundle-analyzer'</span>).BundleAnalyzerPlugin;</span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>);</span><br><span class="line"><span class="keyword">const</span> baseWebpackConfig = <span class="built_in">require</span>(<span class="string">'./webpack.config.base'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = merge(baseWebpackConfig, &#123;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="keyword">new</span> BundleAnalyzerPlugin(),</span><br><span class="line">    ]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>npm run build</code> 构建，会默认打开： <code>http://127.0.0.1:8888/</code>，可以看到各个包的体积：</p>
<p><img src="https://raw.githubusercontent.com/niuxinyu/image/master/runtimeChunk-4W%E5%AD%97%E4%BA%86%E8%A7%A3webpack(%E4%B8%8B).webp" alt="img"></p>
<p>进一步对 <code>vendor</code> 进行拆分，将 <code>vendor</code> 拆分成了4个(使用 <code>splitChunks</code> 进行拆分即可)。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    optimization: &#123;</span><br><span class="line">    concatenateModules: <span class="literal">false</span>,</span><br><span class="line">    splitChunks: &#123;<span class="comment">//分割代码块</span></span><br><span class="line">      maxInitialRequests:<span class="number">6</span>, <span class="comment">//默认是5</span></span><br><span class="line">      cacheGroups: &#123;</span><br><span class="line">        vendor: &#123;</span><br><span class="line">          <span class="comment">//第三方依赖</span></span><br><span class="line">          priority: <span class="number">1</span>,</span><br><span class="line">          name: <span class="string">'vendor'</span>,</span><br><span class="line">          test: <span class="regexp">/node_modules/</span>,</span><br><span class="line">          chunks: <span class="string">'initial'</span>,</span><br><span class="line">          minSize: <span class="number">100</span>,</span><br><span class="line">          minChunks: <span class="number">1</span> <span class="comment">//重复引入了几次</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">'lottie-web'</span>: &#123;</span><br><span class="line">          name: <span class="string">"lottie-web"</span>, <span class="comment">// 单独将 react-lottie 拆包</span></span><br><span class="line">          priority: <span class="number">5</span>, <span class="comment">// 权重需大于`vendor`</span></span><br><span class="line">          test: <span class="regexp">/[\/]node_modules[\/]lottie-web[\/]/</span>,</span><br><span class="line">          chunks: <span class="string">'initial'</span>,</span><br><span class="line">          minSize: <span class="number">100</span>,</span><br><span class="line">          minChunks: <span class="number">1</span> <span class="comment">//重复引入了几次</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重新构建，结果如下所示：</p>
<p><img src="https://raw.githubusercontent.com/niuxinyu/image/master/%E5%AF%B9vender%E8%BF%9B%E8%A1%8C%E6%8B%86%E5%88%86-4W%E5%AD%97%E4%BA%86%E8%A7%A3webpack(%E4%B8%8B).webp" alt="img"></p>
<h3 id="13-webpack自身的优化"><a href="#13-webpack自身的优化" class="headerlink" title="13.webpack自身的优化"></a>13.webpack自身的优化</h3><h4 id="tree-shaking"><a href="#tree-shaking" class="headerlink" title="tree-shaking"></a>tree-shaking</h4><p>如果使用ES6的<code>import</code> 语法，那么在生产环境下，会自动移除没有使用到的代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//math.js</span></span><br><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'aaaaaa'</span>)</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> minus = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'bbbbbb'</span>)</span><br><span class="line">    <span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> &#123;</span><br><span class="line">    add,</span><br><span class="line">    minus</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="keyword">import</span> &#123;add, minus&#125; <span class="keyword">from</span> <span class="string">'./math'</span>;</span><br><span class="line">add(<span class="number">2</span>,<span class="number">3</span>);</span><br></pre></td></tr></table></figure>

<p>构建的最终代码里，<code>minus</code> 函数不会被打包进去。</p>
<h4 id="scope-hosting-作用域提升"><a href="#scope-hosting-作用域提升" class="headerlink" title="scope hosting 作用域提升"></a>scope hosting 作用域提升</h4><p>变量提升，可以减少一些变量声明。在生产环境下，默认开启。</p>
<p>另外，大家测试的时候注意一下，<code>speed-measure-webpack-plugin</code> 和 <code>HotModuleReplacementPlugin</code> 不能同时使用，否则会报错:</p>
<p><img src="https://raw.githubusercontent.com/niuxinyu/image/master/%E4%BD%9C%E7%94%A8%E4%BA%8E%E6%8F%90%E5%8D%87%E6%8A%A5%E9%94%99-4W%E5%AD%97%E4%BA%86%E8%A7%A3webpack(%E4%B8%8B).webp" alt="img"></p>
<h4 id="babel-配置的优化"><a href="#babel-配置的优化" class="headerlink" title="babel 配置的优化"></a>babel 配置的优化</h4><p>如果你对 <code>babel</code> 还不太熟悉的话，那么可以阅读这篇文章：<a href="https://juejin.im/post/5ddff3abe51d4502d56bd143" target="_blank" rel="noopener">不容错过的 Babel7 知识</a>。</p>
<p>在不配置 <code>@babel/plugin-transform-runtime</code> 时，<code>babel</code> 会使用很小的辅助函数来实现类似 <code>_createClass</code> 等公共方法。默认情况下，它将被注入(<code>inject</code>)到需要它的每个文件中。但是这样的结果就是导致构建出来的JS体积变大。</p>
<p>我们也并不需要在每个 <code>js</code> 中注入辅助函数，因此我们可以使用 <code>@babel/plugin-transform-runtime</code>，<code>@babel/plugin-transform-runtime</code> 是一个可以重复使用 <code>Babel</code> 注入的帮助程序，以节省代码大小的插件。</p>
<p>因此我们可以在 <code>.babelrc</code> 中增加 <code>@babel/plugin-transform-runtime</code> 的配置。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"presets"</span>: [],</span><br><span class="line">    <span class="string">"plugins"</span>: [</span><br><span class="line">        [</span><br><span class="line">            <span class="string">"@babel/plugin-transform-runtime"</span></span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以上就是我目前为止使用到的一些优化，如果你有更好的优化方式，欢迎在评论区留言，感谢阅读。</p>
<p>看完这篇文之后，是时候去撸个脚手架了：<a href="https://juejin.im/post/5d37d982e51d45108c59a635" target="_blank" rel="noopener">【中高级前端必备】手摸手教你撸一个脚手架</a></p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://niuxinyu.github.io/niuxinyublog/niuxinyublog/2020/06/27/4W字长文带你深度解锁Webpack系列-中/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Niu">
      <meta itemprop="description" content="文章">
      <meta itemprop="image" content="/niuxinyublog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niu的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/niuxinyublog/2020/06/27/4W字长文带你深度解锁Webpack系列-中/" class="post-title-link" itemprop="url">4W字长文带你深度解锁Webpack系列(中)</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2020-06-27 22:19:50 / 修改时间：22:28:50" itemprop="dateCreated datePublished" datetime="2020-06-27T22:19:50+08:00">2020-06-27</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="4W字长文带你深度解锁Webpack系列（中）"><a href="#4W字长文带你深度解锁Webpack系列（中）" class="headerlink" title="4W字长文带你深度解锁Webpack系列（中）"></a>4W字长文带你深度解锁Webpack系列（中）</h1><p>三篇长文，4W余字，带你解锁 <code>Webpack</code> ，希望读完这三篇文章，你能够对 <code>webpack</code> 的各项配置有一个更为清晰的认识。</p>
<p>本文是第二篇，如果你还没有阅读<a href="https://juejin.im/post/5e5c65fc6fb9a07cd00d8838" target="_blank" rel="noopener">《4W字长文带你深度解锁Webpack系列(基础篇)》</a>，建议阅读之后，再继续阅读本文。</p>
<p>本文会引入更多的 <code>webpack</code> 配置，如果文中有任何错误，欢迎在评论区指正，我会尽快修正。 <code>webpack</code> 优化部分放在了下一篇。</p>
<p>推荐大家参考本文一步一步进行配置，不要总是想着找什么最佳配置，掌握之后，根据自己的需求配置出来的，就是最佳配置。</p>
<p>本文对应的项目地址(编写本文时使用) 供参考：<a href="https://github.com/YvetteLau/webpack/tree/master/webpack-second" target="_blank" rel="noopener">github.com/YvetteLau/w…</a></p>
<h3 id="1-静态资源拷贝"><a href="#1-静态资源拷贝" class="headerlink" title="1. 静态资源拷贝"></a>1. 静态资源拷贝</h3><p>有些时候，我们需要使用已有的JS文件、CSS文件（本地文件），但是不需要 <code>webpack</code> 编译。例如，我们在 <code>public/index.html</code> 中引入了 <code>public</code> 目录下的 <code>js</code> 或 <code>css</code> 文件。这个时候，如果直接打包，那么在构建出来之后，肯定是找不到对应的 <code>js</code> / <code>css</code> 了。</p>
<blockquote>
<p><code>public</code> 目录结构</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">├── public</span><br><span class="line">│   ├── config.js</span><br><span class="line">│   ├── index.html</span><br><span class="line">│   ├── js</span><br><span class="line">│   │   ├── base.js</span><br><span class="line">│   │   └── other.js</span><br><span class="line">│   └── login.html</span><br></pre></td></tr></table></figure>

<p>现在，我们在 <code>index.html</code> 中引入了 <code>./js/base.js</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- index.html --&gt;</span><br><span class="line">&lt;script src="./js/base.js"&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>这时候，我们 <code>npm run dev</code>，会发现有找不到该资源文件的报错信息。</p>
<p>对于这个问题，我们可以手动将其拷贝至构建目录，然后在配置 <code>CleanWebpackPlugin</code> 时，注意不要清空对应的文件或文件夹即可，但是如若这个静态文件时不时的还会修改下，那么依赖于手动拷贝，是很容易出问题的。</p>
<p>不要过于相信自己的记性，依赖于手动拷贝的方式，大多数人应该都有过忘记拷贝的经历，你要是说你从来没忘过。</p>
<p>幸运的是，<code>webpack</code> 为我们这些记性不好又爱偷懒的人提供了好用的插件 <a href="https://webpack.js.org/plugins/copy-webpack-plugin/" target="_blank" rel="noopener">CopyWebpackPlugin</a>，它的作用就是将单个文件或整个目录复制到构建目录。</p>
<p>首先安装一下依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install copy-webpack-plugin -D</span><br></pre></td></tr></table></figure>

<p>修改配置(当前，需要做的是将 <code>public/js</code> 目录拷贝至 <code>dist/js</code> 目录)：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> CopyWebpackPlugin = <span class="built_in">require</span>(<span class="string">'copy-webpack-plugin'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> CopyWebpackPlugin([</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">from</span>: <span class="string">'public/js/*.js'</span>,</span><br><span class="line">                to: path.resolve(__dirname, <span class="string">'dist'</span>, <span class="string">'js'</span>),</span><br><span class="line">                flatten: <span class="literal">true</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">//还可以继续配置其它要拷贝的文件</span></span><br><span class="line">        ])</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时，重新执行 <code>npm run dev</code>，报错信息已经消失。</p>
<p>这里说一下 <code>flatten</code> 这个参数，设置为 <code>true</code>，那么它只会拷贝文件，而不会把文件夹路径都拷贝上，大家可以不设置 <code>flatten</code> 时，看下构建结果。</p>
<p>另外，如果我们要拷贝一个目录下的很多文件，但是想过滤掉某个或某些文件，那么 <code>CopyWebpackPlugin</code> 还为我们提供了 <code>ignore</code> 参数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> CopyWebpackPlugin = <span class="built_in">require</span>(<span class="string">'copy-webpack-plugin'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> CopyWebpackPlugin([</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">from</span>: <span class="string">'public/js/*.js'</span>,</span><br><span class="line">                to: path.resolve(__dirname, <span class="string">'dist'</span>, <span class="string">'js'</span>),</span><br><span class="line">                flatten: <span class="literal">true</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        ], &#123;</span><br><span class="line">            ignore: [<span class="string">'other.js'</span>]</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例如，这里我们忽略掉 <code>js</code> 目录下的 <code>other.js</code> 文件，使用 <code>npm run build</code> 构建，可以看到 <code>dist/js</code> 下不会出现 <code>other.js</code> 文件。 <code>CopyWebpackPlugin</code> 还提供了很多其它的参数，如果当前的配置不能满足你，可以查阅文档进一步修改配置。</p>
<h3 id="2-ProvidePlugin"><a href="#2-ProvidePlugin" class="headerlink" title="2.ProvidePlugin"></a>2.ProvidePlugin</h3><p><code>ProvidePlugin</code> 在我看来，是为懒人准备的，不过也别过度使用，毕竟全局变量不是什么“好东西”。<code>ProvidePlugin</code> 的作用就是不需要 <code>import</code> 或 <code>require</code> 就可以在项目中到处使用。</p>
<p><code>ProvidePlugin</code> 是 <code>webpack</code> 的内置插件，使用方式如下：</p>
<p>首先引入 <code>webpack</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>)</span><br><span class="line"></span><br><span class="line">moudle.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">          identifier1: <span class="string">'module1'</span>,</span><br><span class="line">          identifier2: [<span class="string">'module2'</span>, <span class="string">'property2'</span>]</span><br><span class="line">        &#125;);</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>默认寻找路径是当前文件夹 <code>./**</code> 和 <code>node_modules</code>，当然啦，你可以指定全路径。</p>
<p><code>React</code> 大家都知道的，使用的时候，要在每个文件中引入 <code>React</code>，不然立刻抛错给你看。还有就是 <code>jquery</code>, <code>lodash</code> 这样的库，可能在多个文件中使用，但是懒得每次都引入，好嘛，一起来偷个懒，修改下 <code>webpack</code> 的配置:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">            React: <span class="string">'react'</span>,</span><br><span class="line">            Component: [<span class="string">'react'</span>, <span class="string">'Component'</span>],</span><br><span class="line">            Vue: [<span class="string">'vue/dist/vue.esm.js'</span>, <span class="string">'default'</span>],</span><br><span class="line">            $: <span class="string">'jquery'</span>,</span><br><span class="line">            _map: [<span class="string">'lodash'</span>, <span class="string">'map'</span>]</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样配置之后，你就可以在项目中随心所欲的使用 <code>$</code>、<code>_map</code>了，并且写 <code>React</code> 组件时，也不需要 <code>import</code> <code>React</code> 和 <code>Component</code> 了，如果你想的话，你还可以把 <code>React</code> 的 <code>Hooks</code> 都配置在这里。</p>
<p>另外呢，<code>Vue</code> 的配置后面多了一个 <code>default</code>，这是因为 <code>vue.esm.js</code> 中使用的是 <code>export default</code> 导出的，对于这种，必须要指定 <code>default</code>。<code>React</code> 使用的是 <code>module.exports</code> 导出的，因此不要写 <code>default</code>。</p>
<p>另外，就是如果你项目启动了 <code>eslint</code> 的话，记得修改下 <code>eslint</code> 的配置文件，增加以下配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"globals"</span>: &#123;</span><br><span class="line">        <span class="string">"React"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="string">"Vue"</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="comment">//....</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当然啦，偷懒要有个度，你要是配一大堆全局变量，最终可能会给自己带来麻烦，对自己配置的全局变量一定要负责到底。</p>
<h3 id="3-抽离CSS"><a href="#3-抽离CSS" class="headerlink" title="3.抽离CSS"></a>3.抽离CSS</h3><p>CSS打包我们前面已经说过了，不过呢，有些时候，我们可能会有抽离CSS的需求，即将CSS文件单独打包，这可能是因为打包成一个JS文件太大，影响加载速度，也有可能是为了缓存(例如，只有JS部分有改动)，还有可能就是“我高兴”：我想抽离就抽离，谁也管不着。</p>
<p>不管你是因为什么原因要抽离CSS，只要你有需求，我们就可以去实现。</p>
<p>首先，安装 <code>loader</code>:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mini-css-extract-plugin -D</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>mini-css-extract-plugin</code> 和 <code>extract-text-webpack-plugin</code> 相比:</p>
</blockquote>
<ol>
<li>异步加载</li>
<li>不会重复编译(性能更好)</li>
<li>更容易使用</li>
<li>只适用CSS</li>
</ol>
<p>修改我们的配置文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">'mini-css-extract-plugin'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename: <span class="string">'css/[name].css'</span> <span class="comment">//个人习惯将css文件放在单独目录下</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(le|c)ss$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    MiniCssExtractPlugin.loader, <span class="comment">//替换之前的 style-loader</span></span><br><span class="line">                    <span class="string">'css-loader'</span>, &#123;</span><br><span class="line">                        loader: <span class="string">'postcss-loader'</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            plugins: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                                <span class="keyword">return</span> [</span><br><span class="line">                                    <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>)(&#123;</span><br><span class="line">                                        <span class="string">"overrideBrowserslist"</span>: [</span><br><span class="line">                                            <span class="string">"defaults"</span></span><br><span class="line">                                        ]</span><br><span class="line">                                    &#125;)</span><br><span class="line">                                ]</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="string">'less-loader'</span></span><br><span class="line">                ],</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，我们重新编译：<code>npm run build</code>，目录结构如下所示:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── dist</span><br><span class="line">│   ├── assets</span><br><span class="line">│   │   ├── alita_e09b5c.jpg</span><br><span class="line">│   │   └── thor_e09b5c.jpeg</span><br><span class="line">│   ├── css</span><br><span class="line">│   │   ├── index.css</span><br><span class="line">│   │   └── index.css.map</span><br><span class="line">│   ├── bundle.fb6d0c.js</span><br><span class="line">│   ├── bundle.fb6d0c.js.map</span><br><span class="line">│   └── index.html</span><br></pre></td></tr></table></figure>

<p>前面说了最好新建一个 <code>.browserslistrc</code> 文件，这样可以多个 <code>loader</code> 共享配置，所以，动手在根目录下新建文件 (<code>.browserslistrc</code>)，内容如下（你可以根据自己项目需求，修改为其它的配置）:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">last 2 version</span><br><span class="line">&gt; 0.25%</span><br><span class="line">not dead</span><br></pre></td></tr></table></figure>

<p>修改 <code>webpack.config.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">'mini-css-extract-plugin'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename: <span class="string">'css/[name].css'</span> </span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(c|le)ss$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    MiniCssExtractPlugin.loader,</span><br><span class="line">                    <span class="string">'css-loader'</span>, &#123;</span><br><span class="line">                        loader: <span class="string">'postcss-loader'</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            plugins: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                                <span class="keyword">return</span> [</span><br><span class="line">                                    <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>)()</span><br><span class="line">                                ]</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="string">'less-loader'</span></span><br><span class="line">                ],</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要测试自己的 <code>.browserlistrc</code> 有没有生效也很简单，直接将文件内容修改为 <code>last 1 Chrome versions</code> ，然后对比修改前后的构建出的结果，就能看出来啦。</p>
<p>可以查看更多[browserslistrc]配置项(<a href="https://github.com/browserslist/browserslist" target="_blank" rel="noopener">github.com/browserslis…</a>)</p>
<p>更多配置项，可以查看<a href="https://github.com/webpack-contrib/mini-css-extract-plugin" target="_blank" rel="noopener">mini-css-extract-plugin</a></p>
<h4 id="将抽离出来的css文件进行压缩"><a href="#将抽离出来的css文件进行压缩" class="headerlink" title="将抽离出来的css文件进行压缩"></a>将抽离出来的css文件进行压缩</h4><p>使用 <code>mini-css-extract-plugin</code>，<code>CSS</code> 文件默认不会被压缩，如果想要压缩，需要配置 <code>optimization</code>，首先安装 <code>optimize-css-assets-webpack-plugin</code>.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install optimize-css-assets-webpack-plugin -D</span><br></pre></td></tr></table></figure>

<p>修改webpack配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> OptimizeCssPlugin = <span class="built_in">require</span>(<span class="string">'optimize-css-assets-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> OptimizeCssPlugin()</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意，这里将 <code>OptimizeCssPlugin</code> 直接配置在 <code>plugins</code> 里面，那么 <code>js</code> 和 <code>css</code> 都能够正常压缩，如果你将这个配置在 <code>optimization</code>，那么需要再配置一下 <code>js</code> 的压缩(开发环境下不需要去做CSS的压缩，因此后面记得将其放到 <code>webpack.config.prod.js</code> 中哈)。</p>
<p>配置完之后，测试的时候发现，抽离之后，修改 <code>css</code> 文件时，第一次页面会刷新，但是第二次页面不会刷新 —— 好嘛，我平时的业务中用不着抽离 <code>css</code>，这个问题搁置了好多天(准确来说是忘记了)。</p>
<p>3月8号再次修改这篇文章的时候，正好看到了 <code>MiniCssExtractPlugin.loader</code> 对应的 <code>option</code> 设置，我们再次修改下对应的 <code>rule</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    rules: [</span><br><span class="line">        &#123;</span><br><span class="line">            test: <span class="regexp">/\.(c|le)ss$/</span>,</span><br><span class="line">            use: [</span><br><span class="line">                &#123;</span><br><span class="line">                    loader: MiniCssExtractPlugin.loader,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        hmr: isDev,</span><br><span class="line">                        reloadAll: <span class="literal">true</span>,</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="comment">//...</span></span><br><span class="line">            ],</span><br><span class="line">            exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-按需加载"><a href="#4-按需加载" class="headerlink" title="4.按需加载"></a>4.按需加载</h3><p>很多时候我们不需要一次性加载所有的JS文件，而应该在不同阶段去加载所需要的代码。<code>webpack</code>内置了强大的分割代码的功能可以实现按需加载。</p>
<p>比如，我们在点击了某个按钮之后，才需要使用使用对应的JS文件中的代码，需要使用 <code>import()</code> 语法：</p>
<p>要支持 <code>import()</code> 语法，需要增加 <code>babel</code> 的配置，安装依赖:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install @babel/plugin-syntax-dynamic-import -D</span><br></pre></td></tr></table></figure>

<p>修改<code>.babelrc</code> 的配置</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"presets"</span>: [<span class="string">"@babel/preset-env"</span>],</span><br><span class="line">    <span class="attr">"plugins"</span>: [</span><br><span class="line">        [</span><br><span class="line">            <span class="string">"@babel/plugin-transform-runtime"</span>,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"corejs"</span>: <span class="number">3</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="string">"@babel/plugin-syntax-dynamic-import"</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>npm run build</code> 进行构建，构建结果如下：</p>
<hr>
<p>此处有图</p>
<hr>
<p><code>webpack</code> 遇到 <code>import(****)</code> 这样的语法的时候，会这样处理：</p>
<ul>
<li>以**** 为入口新生成一个 <code>Chunk</code></li>
<li>当代码执行到 <code>import</code> 所在的语句时，才会加载该 <code>Chunk</code> 所对应的文件（如这里的1.bundle.8bf4dc.js）</li>
</ul>
<p>大家可以在浏览器中的控制台中，在 <code>Network</code> 的 <code>Tab页</code> 查看文件加载的情况，只有点击之后，才会加载对应的 <code>JS</code> 。</p>
<h3 id="5-热更新"><a href="#5-热更新" class="headerlink" title="5.热更新"></a>5.热更新</h3><ol>
<li>首先配置 <code>devServer</code> 的 <code>hot</code> 为 <code>true</code></li>
<li>并且在 <code>plugins</code> 中增加 <code>new webpack.HotModuleReplacementPlugin()</code></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        hot: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.HotModuleReplacementPlugin() <span class="comment">//热更新插件</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们配置了 <code>HotModuleReplacementPlugin</code> 之后，会发现，此时我们修改代码，仍然是整个页面都会刷新。不希望整个页面都刷新，还需要修改入口文件：</p>
<ol start="3">
<li>在入口文件中新增:</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="built_in">module</span> &amp;&amp; <span class="built_in">module</span>.hot) &#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.accept()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时，再修改代码，不会造成整个页面的刷新。</p>
<h3 id="6-多页应用打包"><a href="#6-多页应用打包" class="headerlink" title="6.多页应用打包"></a>6.多页应用打包</h3><p>有时，我们的应用不一定是一个单页应用，而是一个多页应用，那么如何使用 <code>webpack</code> 进行打包呢。为了生成目录看起来清晰，不生成单独的 <code>map</code> 文件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        index: <span class="string">'./src/index.js'</span>,</span><br><span class="line">        login: <span class="string">'./src/login.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        filename: <span class="string">'[name].[hash:6].js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">'./public/index.html'</span>,</span><br><span class="line">            filename: <span class="string">'index.html'</span> <span class="comment">//打包后的文件名</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">'./public/login.html'</span>,</span><br><span class="line">            filename: <span class="string">'login.html'</span> <span class="comment">//打包后的文件名</span></span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果需要配置多个 <code>HtmlWebpackPlugin</code>，那么 <code>filename</code> 字段不可缺省，否则默认生成的都是 <code>index.html</code>，如果你希望 <code>html</code> 的文件名中也带有 <code>hash</code>，那么直接修改 <code>fliename</code> 字段即可，例如: <code>filename: &#39;login.[hash:6].html&#39;</code>。</p>
<p>生成目录如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── dist</span><br><span class="line">│   ├── 2.463ccf.js</span><br><span class="line">│   ├── assets</span><br><span class="line">│   │   └── thor_e09b5c.jpeg</span><br><span class="line">│   ├── css</span><br><span class="line">│   │   ├── index.css</span><br><span class="line">│   │   └── login.css</span><br><span class="line">│   ├── index.463ccf.js</span><br><span class="line">│   ├── index.html</span><br><span class="line">│   ├── js</span><br><span class="line">│   │   └── base.js</span><br><span class="line">│   ├── login.463ccf.js</span><br><span class="line">│   └── login.html</span><br></pre></td></tr></table></figure>

<p>看起来，似乎是OK了，不过呢，查看 <code>index.html</code> 和 <code>login.html</code> 会发现，都同时引入了 <code>index.f7d21a.js</code> 和 <code>login.f7d21a.js</code>，通常这不是我们想要的，我们希望，<code>index.html</code> 中只引入 <code>index.f7d21a.js</code>，<code>login.html</code> 只引入 <code>login.f7d21a.js</code>。</p>
<p><code>HtmlWebpackPlugin</code> 提供了一个 <code>chunks</code> 的参数，可以接受一个数组，配置此参数仅会将数组中指定的js引入到html文件中，此外，如果你需要引入多个JS文件，仅有少数不想引入，还可以指定 <code>excludeChunks</code> 参数，它接受一个数组。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">'./public/index.html'</span>,</span><br><span class="line">            filename: <span class="string">'index.html'</span>, <span class="comment">//打包后的文件名</span></span><br><span class="line">            chunks: [<span class="string">'index'</span>]</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">'./public/login.html'</span>,</span><br><span class="line">            filename: <span class="string">'login.html'</span>, <span class="comment">//打包后的文件名</span></span><br><span class="line">            chunks: [<span class="string">'login'</span>]</span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行 <code>npm run build</code>，可以看到 <code>index.html</code> 中仅引入了 <code>index</code> 的 <code>JS</code> 文件，而 <code>login.html</code> 中也仅引入了 <code>login</code> 的 <code>JS</code> 文件，符合我们的预期。</p>
<h3 id="7-resolve-配置"><a href="#7-resolve-配置" class="headerlink" title="7.resolve 配置"></a>7.resolve 配置</h3><p><code>resolve</code> 配置 <code>webpack</code> 如何寻找模块所对应的文件。<code>webpack</code> 内置 <code>JavaScript</code> 模块化语法解析功能，默认会采用模块化标准里约定好的规则去寻找，但你可以根据自己的需要修改默认的规则。</p>
<ol>
<li>modules</li>
</ol>
<p><code>resolve.modules</code> 配置 <code>webpack</code> 去哪些目录下寻找第三方模块，默认情况下，只会去 <code>node_modules</code> 下寻找，如果你我们项目中某个文件夹下的模块经常被导入，不希望写很长的路径，那么就可以通过配置 <code>resolve.modules</code> 来简化。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">    resolve: &#123;</span><br><span class="line">        modules: [<span class="string">'./src/components'</span>, <span class="string">'node_modules'</span>] <span class="comment">//从左到右依次查找</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样配置之后，我们 <code>import Dialog from &#39;dialog&#39;</code>，会去寻找 <code>./src/components/dialog</code>，不再需要使用相对路径导入。如果在 <code>./src/components</code> 下找不到的话，就会到 <code>node_modules</code> 下寻找。</p>
<ol start="2">
<li>alias</li>
</ol>
<p><code>resolve.alias</code> 配置项通过别名把原导入路径映射成一个新的导入路径，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">    resolve: &#123;</span><br><span class="line">        alias: &#123;</span><br><span class="line">            <span class="string">'react-native'</span>: <span class="string">'@my/react-native-web'</span> <span class="comment">//这个包名是我随便写的哈</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例如，我们有一个依赖 <code>@my/react-native-web</code> 可以实现 <code>react-native</code> 转 <code>web</code>。我们代码一般下面这样:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; View, ListView, StyleSheet, Animated &#125; <span class="keyword">from</span> <span class="string">'react-native'</span>;</span><br></pre></td></tr></table></figure>

<p>配置了别名之后，在转 web 时，会从 <code>@my/react-native-web</code> 寻找对应的依赖。</p>
<p>当然啦，如果某个依赖的名字太长了，你也可以给它配置一个短一点的别名，这样用起来比较爽，尤其是带有 <code>scope</code> 的包。</p>
<ol start="3">
<li>extensions</li>
</ol>
<p>适配多端的项目中，可能会出现 <code>.web.js</code>, <code>.wx.js</code>，例如在转web的项目中，我们希望首先找 <code>.web.js</code>，如果没有，再找 <code>.js</code>。我们可以这样配置:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">    resolve: &#123;</span><br><span class="line">        extensions: [<span class="string">'web.js'</span>, <span class="string">'.js'</span>] <span class="comment">//当然，你还可以配置 .json, .css</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先寻找 <code>../dialog.web.js</code> ，如果不存在的话，再寻找 <code>../dialog.js</code>。这在适配多端的代码中非常有用，否则，你就需要根据不同的平台去引入文件(以牺牲了速度为代价)。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> dialog <span class="keyword">from</span> <span class="string">'../dialog'</span>;</span><br></pre></td></tr></table></figure>

<p>当然，配置 <code>extensions</code>，我们就可以缺省文件后缀，在导入语句没带文件后缀时，会自动带上<code>extensions</code> 中配置的后缀后，去尝试访问文件是否存在，因此要将高频的后缀放在前面，并且数组不要太长，减少尝试次数。如果没有配置 <code>extensions</code>，默认只会找对对应的js文件。</p>
<ol start="4">
<li>enforceExtension</li>
</ol>
<p>如果配置了 <code>resolve.enforceExtension</code> 为 <code>true</code>，那么导入语句不能缺省文件后缀。</p>
<ol start="5">
<li>mainFields</li>
</ol>
<p>有一些第三方模块会提供多份代码，例如 <code>bootstrap</code>，可以查看 <code>bootstrap</code> 的 <code>package.json</code> 文件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"style"</span>: <span class="string">"dist/css/bootstrap.css"</span>,</span><br><span class="line">    <span class="attr">"sass"</span>: <span class="string">"scss/bootstrap.scss"</span>,</span><br><span class="line">    <span class="attr">"main"</span>: <span class="string">"dist/js/bootstrap"</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>resolve.mainFields</code> 默认配置是 <code>[&#39;browser&#39;, &#39;main&#39;]</code>，即首先找对应依赖 <code>package.json</code> 中的 <code>brower</code> 字段，如果没有，找 <code>main</code> 字段。</p>
<p>如：<code>import &#39;bootstrap&#39;</code> 默认情况下，找得是对应的依赖的 <code>package.json</code> 的 <code>main</code> 字段指定的文件，即 <code>dist/js/bootstrap</code>。</p>
<p>假设我们希望，<code>import &#39;bootsrap&#39;</code> 默认去找 <code>css</code> 文件的话，可以配置 <code>resolve.mainFields</code> 为:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">    resolve: &#123;</span><br><span class="line">        mainFields: [<span class="string">'style'</span>, <span class="string">'main'</span>] </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-区分不同的环境"><a href="#8-区分不同的环境" class="headerlink" title="8.区分不同的环境"></a>8.区分不同的环境</h3><p>目前为止我们 <code>webpack</code> 的配置，都定义在了 <code>webpack.config.js</code> 中，对于需要区分是开发环境还是生产环境的情况，我们根据 <code>process.env.NODE_ENV</code> 去进行了区分配置，但是配置文件中如果有多处需要区分环境的配置，这种显然不是一个好办法。</p>
<p>更好的做法是创建多个配置文件，如: <code>webpack.base.js</code>、<code>webpack.dev.js</code>、<code>webpack.prod.js</code>。</p>
<ul>
<li><code>webpack.base.js</code> 定义公共的配置</li>
<li><code>webpack.dev.js</code>：定义开发环境的配置</li>
<li><code>webpack.prod.js</code>：定义生产环境的配置</li>
</ul>
<p><a href="https://www.npmjs.com/package/webpack-merge" target="_blank" rel="noopener">webpack-merge</a> 专为 <code>webpack</code> 设计，提供了一个 <code>merge</code> 函数，用于连接数组，合并对象。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-merge -D</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>);</span><br><span class="line">merge(&#123;</span><br><span class="line">    devtool: <span class="string">'cheap-module-eval-source-map'</span>,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;<span class="attr">a</span>: <span class="number">1</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    devtool: <span class="string">'none'</span>,</span><br><span class="line">    mode: <span class="string">"production"</span>,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;<span class="attr">a</span>: <span class="number">2</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">b</span>: <span class="number">1</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>],</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//合并后的结果为</span></span><br><span class="line">&#123;</span><br><span class="line">    devtool: <span class="string">'none'</span>,</span><br><span class="line">    mode: <span class="string">"production"</span>,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;<span class="attr">a</span>: <span class="number">1</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">a</span>: <span class="number">2</span>&#125;,</span><br><span class="line">            &#123;<span class="attr">b</span>: <span class="number">1</span>&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>webpack.config.base.js</code> 中是通用的 <code>webpack</code> 配置，以 <code>webpack.config.dev.js</code> 为例，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.dev.js</span></span><br><span class="line"><span class="keyword">const</span> merge = <span class="built_in">require</span>(<span class="string">'webpack-merge'</span>);</span><br><span class="line"><span class="keyword">const</span> baseWebpackConfig = <span class="built_in">require</span>(<span class="string">'./webpack.config.base'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = merge(baseWebpackConfig, &#123;</span><br><span class="line">    mode: <span class="string">'development'</span></span><br><span class="line">    <span class="comment">//...其它的一些配置</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>然后修改我们的 <code>package.json</code>，指定对应的 <code>config</code> 文件：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//package.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">        <span class="attr">"dev"</span>: <span class="string">"cross-env NODE_ENV=development webpack-dev-server --config=webpack.config.dev.js"</span>,</span><br><span class="line">        <span class="attr">"build"</span>: <span class="string">"cross-env NODE_ENV=production webpack --config=webpack.config.prod.js"</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你可以使用 <code>merge</code> 合并，也可以使用 <code>merge.smart</code> 合并，<code>merge.smart</code> 在合并<code>loader</code>时，会将同一匹配规则的进行合并，<code>webpack-merge</code> 的说明文档中给出了详细的示例。</p>
<h3 id="9-定义环境变量"><a href="#9-定义环境变量" class="headerlink" title="9.定义环境变量"></a>9.定义环境变量</h3><p>很多时候，我们在开发环境中会使用预发环境或者是本地的域名，生产环境中使用线上域名，我们可以在 <code>webpack</code> 定义环境变量，然后在代码中使用。</p>
<p>使用 <code>webpack</code> 内置插件 <code>DefinePlugin</code> 来定义环境变量。</p>
<p><code>DefinePlugin</code> 中的每个键，是一个标识符.</p>
<ul>
<li>如果 <code>value</code> 是一个字符串，会被当做 <code>code</code> 片段</li>
<li>如果 <code>value</code> 不是一个字符串，会被<code>stringify</code></li>
<li>如果 <code>value</code> 是一个对象，正常对象定义即可</li>
<li>如果 <code>key</code> 中有 <code>typeof</code>，它只针对 <code>typeof</code> 调用定义</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.dev.js</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">'webpack'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">            DEV: <span class="built_in">JSON</span>.stringify(<span class="string">'dev'</span>), <span class="comment">//字符串</span></span><br><span class="line">            FLAG: <span class="string">'true'</span> <span class="comment">//FLAG 是个布尔类型</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="keyword">if</span>(DEV === <span class="string">'dev'</span>) &#123;</span><br><span class="line">    <span class="comment">//开发环境</span></span><br><span class="line">&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//生产环境</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="10-利用webpack解决跨域问题"><a href="#10-利用webpack解决跨域问题" class="headerlink" title="10.利用webpack解决跨域问题"></a>10.利用webpack解决跨域问题</h3><p>假设前端在3000端口，服务端在4000端口，我们通过 <code>webpack</code> 配置的方式去实现跨域。</p>
<p>首先，我们在本地创建一个 <code>server.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = express();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/api/user'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    res.json(&#123;<span class="attr">name</span>: <span class="string">'刘小夕'</span>&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">4000</span>);</span><br></pre></td></tr></table></figure>

<p>执行代码(<code>run code</code>)，现在我们可以在浏览器中访问到此接口: <code>http://localhost:4000/api/user</code>。</p>
<p>在 <code>index.js</code> 中请求 <code>/api/user</code>，修改 <code>index.js</code> 如下:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//需要将 localhost:3000 转发到 localhost:4000（服务端） 端口</span></span><br><span class="line">fetch(<span class="string">"/api/user"</span>)</span><br><span class="line">    .then(<span class="function"><span class="params">response</span> =&gt;</span> response.json())</span><br><span class="line">    .then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(data))</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err));</span><br></pre></td></tr></table></figure>

<p>我们希望通过配置代理的方式，去访问 4000 的接口。</p>
<h4 id="配置代理"><a href="#配置代理" class="headerlink" title="配置代理"></a>配置代理</h4><p>修改 <code>webpack</code> 配置:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        proxy: &#123;</span><br><span class="line">            <span class="string">"/api"</span>: <span class="string">"http://localhost:4000"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重新执行 <code>npm run dev</code>，可以看到控制台打印出来了 <code>{name: &quot;刘小夕&quot;}</code>，实现了跨域。</p>
<p>大多情况，后端提供的接口并不包含  <code>/api</code>，即：<code>/user</code>，<code>/info</code>、<code>/list</code> 等，配置代理时，我们不可能罗列出每一个api。</p>
<p>修改我们的服务端代码，并重新执行。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//server.js</span></span><br><span class="line"><span class="keyword">let</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = express();</span><br><span class="line"></span><br><span class="line">app.get(<span class="string">'/user'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    res.json(&#123;<span class="attr">name</span>: <span class="string">'刘小夕'</span>&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(<span class="number">4000</span>);</span><br></pre></td></tr></table></figure>

<p>尽管后端的接口并不包含 <code>/api</code>，我们在请求后端接口时，仍然以 <code>/api</code> 开头，在配置代理时，去掉 <code>/api</code>，修改配置:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        proxy: &#123;</span><br><span class="line">            <span class="string">'/api'</span>: &#123;</span><br><span class="line">                target: <span class="string">'http://localhost:4000'</span>,</span><br><span class="line">                pathRewrite: &#123;</span><br><span class="line">                    <span class="string">'/api'</span>: <span class="string">''</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>重新执行 <code>npm run dev</code>，在浏览器中访问： <code>http://localhost:3000/</code>，控制台中也打印出了<code>{name: &quot;刘小夕&quot;}</code>，跨域成功，</p>
<h3 id="11-前端模拟数据"><a href="#11-前端模拟数据" class="headerlink" title="11.前端模拟数据"></a>11.前端模拟数据</h3><blockquote>
<p>简单数据模拟</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        before(app) &#123;</span><br><span class="line">            app.get(<span class="string">'/user'</span>, (req, res) =&gt; &#123;</span><br><span class="line">                res.json(&#123;<span class="attr">name</span>: <span class="string">'刘小夕'</span>&#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>src/index.js</code> 中直接请求 <code>/user</code> 接口。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">"user"</span>)</span><br><span class="line">    .then(<span class="function"><span class="params">response</span> =&gt;</span> response.json())</span><br><span class="line">    .then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(data))</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用 mocker-api mock数据接口</p>
</blockquote>
<p>mocker-api 为 REST API 创建模拟 API。在没有实际 REST API 服务器的情况下测试应用程序时，它会很有用。</p>
<ol>
<li>安装 <a href="https://www.npmjs.com/package/mocker-api" target="_blank" rel="noopener">mocker-api</a>:</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install mocker-api -D</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在项目中新建mock文件夹，新建 mocker.js.文件，文件如下:</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="string">'GET /user'</span>: &#123;<span class="attr">name</span>: <span class="string">'刘小夕'</span>&#125;,</span><br><span class="line">    <span class="string">'POST /login/account'</span>: <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> &#123; password, username &#125; = req.body</span><br><span class="line">        <span class="keyword">if</span> (password === <span class="string">'888888'</span> &amp;&amp; username === <span class="string">'admin'</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.send(&#123;</span><br><span class="line">                status: <span class="string">'ok'</span>,</span><br><span class="line">                code: <span class="number">0</span>,</span><br><span class="line">                token: <span class="string">'sdfsdfsdfdsf'</span>,</span><br><span class="line">                data: &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">'刘小夕'</span> &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> res.send(&#123; <span class="attr">status</span>: <span class="string">'error'</span>, <span class="attr">code</span>: <span class="number">403</span> &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>修改 <code>webpack.config.base.js</code>:</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> apiMocker = <span class="built_in">require</span>(<span class="string">'mocker-api'</span>);</span><br><span class="line"><span class="built_in">module</span>.export = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        before(app)&#123;</span><br><span class="line">            apiMocker(app, path.resolve(<span class="string">'./mock/mocker.js'</span>))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样，我们就可以直接在代码中像请求后端接口一样对mock数据进行请求。</p>
<ol start="4">
<li><p>重启 <code>npm run dev</code>，可以看到，控制台成功打印出来 <code>{name: &#39;刘小夕&#39;}</code></p>
</li>
<li><p>我们再修改下 <code>src/index.js</code>，检查下POST接口是否成功</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//src/index.js</span></span><br><span class="line">fetch(<span class="string">"/login/account"</span>, &#123;</span><br><span class="line">    method: <span class="string">"POST"</span>,</span><br><span class="line">    headers: &#123;</span><br><span class="line">        <span class="string">'Accept'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">        <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    body: <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">        username: <span class="string">"admin"</span>,</span><br><span class="line">        password: <span class="string">"888888"</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">    .then(<span class="function"><span class="params">response</span> =&gt;</span> response.json())</span><br><span class="line">    .then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(data))</span><br><span class="line">    .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err));</span><br></pre></td></tr></table></figure>

<p>可以在控制台中看到接口返回的成功的数据。</p>
<p>进阶篇就到这里结束啦，最后一篇是优化篇，下周一带上小板凳和瓜子来约。</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://niuxinyu.github.io/niuxinyublog/niuxinyublog/2020/06/27/4W字长文带你深度解锁Webpack系列-上/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Niu">
      <meta itemprop="description" content="文章">
      <meta itemprop="image" content="/niuxinyublog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niu的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/niuxinyublog/2020/06/27/4W字长文带你深度解锁Webpack系列-上/" class="post-title-link" itemprop="url">4W字长文带你深度解锁Webpack系列(上)</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2020-06-27 22:18:08 / 修改时间：22:32:00" itemprop="dateCreated datePublished" datetime="2020-06-27T22:18:08+08:00">2020-06-27</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="4W字长文带你深度解锁Webpack系列-上"><a href="#4W字长文带你深度解锁Webpack系列-上" class="headerlink" title="4W字长文带你深度解锁Webpack系列(上)"></a>4W字长文带你深度解锁Webpack系列(上)</h1><p>三篇长文，4W余字，带你解锁 <code>Webpack</code> ，希望读完这三篇文章，你能够对 <code>webpack</code> 的各项配置有一个更为清晰的认识。</p>
<h3 id="1-webpack-是什么？"><a href="#1-webpack-是什么？" class="headerlink" title="1.webpack 是什么？"></a>1.webpack 是什么？</h3><p><code>webpack</code> 是一个现代 <code>JavaScript</code> 应用程序的静态模块打包器，当 <code>webpack</code> 处理应用程序时，会递归构建一个依赖关系图，其中包含应用程序需要的每个模块，然后将这些模块打包成一个或多个 <code>bundle</code>。</p>
<h3 id="2-webpack-的核心概念"><a href="#2-webpack-的核心概念" class="headerlink" title="2.webpack 的核心概念"></a>2.webpack 的核心概念</h3><ul>
<li>entry: 入口</li>
<li>output: 输出</li>
<li>loader: 模块转换器，用于把模块原内容按照需求转换成新内容</li>
<li>插件(plugins): 扩展插件，在webpack构建流程中的特定时机注入扩展逻辑来改变构建结果或做你想要做的事情</li>
</ul>
<h3 id="3-初始化项目"><a href="#3-初始化项目" class="headerlink" title="3.初始化项目"></a>3.初始化项目</h3><p>新建一个文件夹，如: <code>webpack-first</code> (当然，你可以使用任意一个你喜欢的项目名)。推荐大家参考本文一步一步进行配置，不要总是在网上找什么最佳配置，你掌握了<code>webpack</code>之后，根据自己的需求配置出来的，就是最佳配置。</p>
<p>本篇文章对应的项目地址(编写本文时使用): <a href="https://github.com/YvetteLau/webpack/tree/master/webpack-first" target="_blank" rel="noopener">github.com/YvetteLau/w…</a></p>
<p>使用 <code>npm init -y</code> 进行初始化(也可以使用 <code>yarn</code>)。</p>
<p>要使用 <code>webpack</code>，那么必然需要安装 <code>webpack</code>、<code>webpack-cli</code>:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack webpack-cli -D</span><br></pre></td></tr></table></figure>

<p>鉴于前端技术变更迅速，祭出本篇文章基于 <code>webpack</code> 的版本号:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">├── webpack@4.41.5 </span><br><span class="line">└── webpack-cli@3.3.10</span><br></pre></td></tr></table></figure>

<p>从 <code>wepack V4.0.0</code> 开始， <code>webpack</code> 是开箱即用的，在不引入任何配置文件的情况下就可以使用。</p>
<p>新建 <code>src/index.js</code> 文件，我们在文件中随便写点什么:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    getName() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dog = <span class="keyword">new</span> Animal(<span class="string">'dog'</span>);</span><br></pre></td></tr></table></figure>

<p>使用 <code>npx webpack --mode=development</code> 进行构建，默认是 <code>production</code> 模式，我们为了更清楚得查看打包后的代码，使用 <code>development</code> 模式。</p>
<p>可以看到项目下多了个 <code>dist</code> 目录，里面有一个打包出来的文件 <code>main.js</code>。</p>
<p><code>webpack</code> 有默认的配置，如默认的入口文件是 <code>./src</code>，默认打包到<code>dist/main.js</code>。更多的默认配置可以查看: <code>node_modules/webpack/lib/WebpackOptionsDefaulter.js</code>。</p>
<p>查看 <code>dist/main.js</code> 文件，可以看到，<code>src/index.js</code> 并没有被转义为低版本的代码，这显然不是我们想要的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"./src/index.js"</span>:</span><br><span class="line">        (<span class="function"><span class="keyword">function</span> (<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="built_in">eval</span>(<span class="string">"class Animal &#123;\n    constructor(name) &#123;\n        this.name = name;\n    &#125;\n    getName() &#123;\n        return this.name;\n    &#125;\n&#125;\n\nconst dog = new Animal('dog');\n\n//# sourceURL=webpack:///./src/index.js?"</span>);</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-将JS转义为低版本"><a href="#4-将JS转义为低版本" class="headerlink" title="4.将JS转义为低版本"></a>4.将JS转义为低版本</h3><p>前面我们说了 <code>webpack</code> 的四个核心概念，其中之一就是 <code>loader</code>，<code>loader</code> 用于对源代码进行转换，这正是我们现在所需要的。</p>
<p>将JS代码向低版本转换，我们需要使用 <code>babel-loader</code>。</p>
<h4 id="babel-loader"><a href="#babel-loader" class="headerlink" title="babel-loader"></a>babel-loader</h4><p>首先安装一下 <code>babel-loader</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install babel-loader -D</span><br></pre></td></tr></table></figure>

<p>此外，我们还需要配置 <code>babel</code>，为此我们安装一下以下依赖:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm install @babel/core @babel/preset-env @babel/plugin-transform-runtime -D</span><br><span class="line"></span><br><span class="line">npm install @babel/runtime @babel/runtime-corejs3 -S</span><br></pre></td></tr></table></figure>

<p>对babel7配置不熟悉的小伙伴，可以阅读一下这篇文章: <a href="https://juejin.im/post/5ddff3abe51d4502d56bd143" target="_blank" rel="noopener">不可错过的 Babel7 知识</a></p>
<p>新建 <code>webpack.config.js</code>，如下:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">                use: [<span class="string">'babel-loader'</span>],</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span> <span class="comment">//排除 node_modules 目录</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>建议给 <code>loader</code> 指定 <code>include</code> 或是 <code>exclude</code>，指定其中一个即可，因为 <code>node_modules</code> 目录通常不需要我们去编译，排除后，有效提升编译效率。</p>
<p>这里，我们可以在 <code>.babelrc</code> 中编写 <code>babel</code> 的配置，也可以在 <code>webpack.config.js</code> 中进行配置。</p>
<p><strong>先在 <code>.babelrc</code> 下进行 <code>babel</code>的配置</strong></p>
<h4 id="创建一个-babelrc"><a href="#创建一个-babelrc" class="headerlink" title="创建一个 .babelrc"></a>创建一个 .babelrc</h4><p>配置如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"presets"</span>: [<span class="string">"@babel/preset-env"</span>],</span><br><span class="line">    <span class="attr">"plugins"</span>: [</span><br><span class="line">        [</span><br><span class="line">            <span class="string">"@babel/plugin-transform-runtime"</span>,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"corejs"</span>: <span class="number">3</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，我们重新执行 <code>npx webpack --mode=development</code>，查看 <code>dist/main.js</code>，会发现已经被编译成了低版本的JS代码。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"><span class="built_in">eval</span>(<span class="string">"__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _babel_runtime_corejs3_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @babel/runtime-corejs3/helpers/classCallCheck */ \"./node_modules/_@babel_runtime-corejs3@7.8.7@@babel/runtime-corejs3/helpers/classCallCheck.js\");\n/* harmony import */ var _babel_runtime_corejs3_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_corejs3_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _babel_runtime_corejs3_helpers_createClass__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @babel/runtime-corejs3/helpers/createClass */ \"./node_modules/_@babel_runtime-corejs3@7.8.7@@babel/runtime-corejs3/helpers/createClass.js\");\n/* harmony import */ var _babel_runtime_corejs3_helpers_createClass__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(_babel_runtime_corejs3_helpers_createClass__WEBPACK_IMPORTED_MODULE_1__);\n\n\n\nvar Animal = /*#__PURE__*/function () &#123;\n  function Animal(name) &#123;\n    _babel_runtime_corejs3_helpers_classCallCheck__WEBPACK_IMPORTED_MODULE_0___default()(this, Animal);\n\n    this.name = name;\n  &#125;\n\n  _babel_runtime_corejs3_helpers_createClass__WEBPACK_IMPORTED_MODULE_1___default()(Animal, [&#123;\n    key: \"getName\",\n    value: function getName() &#123;\n      return this.name;\n    &#125;\n  &#125;]);\n\n  return Animal;\n&#125;();\n\nvar dog = new Animal('dog');\n\n//# sourceURL=webpack:///./src/index.js?"</span>);</span><br></pre></td></tr></table></figure>

<p><strong>再 <code>webpack.config.js</code></strong> 中配置 <code>babel</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// mode: 'development',</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        presets: [<span class="string">"@babel/preset-env"</span>],</span><br><span class="line">                        plugins: [</span><br><span class="line">                            [</span><br><span class="line">                                <span class="string">"@babel/plugin-transform-runtime"</span>,</span><br><span class="line">                                &#123;</span><br><span class="line">                                    <span class="string">"corejs"</span>: <span class="number">3</span></span><br><span class="line">                                &#125;</span><br><span class="line">                            ]</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里有几点需要说明：</p>
<ul>
<li><code>loader</code> 需要配置在 <code>module.rules</code> 中，<code>rules</code> 是一个数组。</li>
<li><code>loader</code> 的格式为:</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.jsx?$/</span>,<span class="comment">//匹配规则</span></span><br><span class="line">    use: <span class="string">'babel-loader'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>或者也可以像下面这样:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//适用于只有一个 loader 的情况</span></span><br><span class="line">&#123;</span><br><span class="line">    test: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">    loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">    options: &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>test</code> 字段是匹配规则，针对符合规则的文件进行处理。</p>
<p><code>use</code> 字段有几种写法</p>
<ul>
<li>可以是一个字符串，例如上面的 <code>use: &#39;babel-loader&#39;</code></li>
<li><code>use</code> 字段可以是一个数组，例如处理CSS文件是，<code>use: [&#39;style-loader&#39;, &#39;css-loader&#39;]</code></li>
<li><code>use</code> 数组的每一项既可以是字符串也可以是一个对象，当我们需要在<code>webpack</code> 的配置文件中对 <code>loader</code> 进行配置，就需要将其编写为一个对象，并且在此对象的 <code>options</code> 字段中进行配置，如：</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">rules: [</span><br><span class="line">    &#123;</span><br><span class="line">        test: <span class="regexp">/\.jsx?$/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">            loader: <span class="string">'babel-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">                presets: [<span class="string">"@babel/preset-env"</span>]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>上面我们说了如何将JS的代码编译成向下兼容的代码，当然你可以还需要一些其它的 <code>babel</code> 的插件和预设，例如 <code>@babel/preset-react</code>，<code>@babel/plugin-proposal-optional-chaining</code> 等，不过，<code>babel</code> 的配置并非本文的重点，我们继续往下。</p>
<p>不要说细心的小伙伴了，即使是粗心的小伙伴肯定也发现了，我们在使用 <code>webpack</code> 进行打包的时候，一直运行的都是 <code>npx webpack --mode=development</code> 是否可以将 <code>mode</code> 配置在 <code>webpack.config.js</code> 中呢？显然是可以的。</p>
<h3 id="5-mode"><a href="#5-mode" class="headerlink" title="5.mode"></a>5.mode</h3><p>将 <code>mode</code> 增加到 <code>webpack.config.js</code> 中:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">    mode: <span class="string">"development"</span>,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>mode</code> 配置项，告知 <code>webpack</code> 使用相应模式的内置优化。</p>
<p><code>mode</code> 配置项，支持以下两个配置:</p>
<ul>
<li><code>development</code>：将 <code>process.env.NODE_ENV</code> 的值设置为 <code>development</code>，启用 <code>NamedChunksPlugin</code> 和 <code>NamedModulesPlugin</code></li>
<li><code>production</code>：将 <code>process.env.NODE_ENV</code> 的值设置为 <code>production</code>，启用 <code>FlagDependencyUsagePlugin</code>, <code>FlagIncludedChunksPlugin</code>, <code>ModuleConcatenationPlugin</code>, <code>NoEmitOnErrorsPlugin</code>, <code>OccurrenceOrderPlugin</code>, <code>SideEffectsFlagPlugin</code> 和 <code>UglifyJsPlugin</code></li>
</ul>
<p>现在，我们直接使用 <code>npx webpack</code> 进行编译即可。</p>
<h3 id="6-在浏览器中查看页面"><a href="#6-在浏览器中查看页面" class="headerlink" title="6.在浏览器中查看页面"></a>6.在浏览器中查看页面</h3><p>搞了这么久，还不能在浏览器中查看页面，这显然不能忍！</p>
<p>查看页面，难免就需要 <code>html</code> 文件，有小伙伴可能知道，有时我们会指定打包文件中带有 <code>hash</code>，那么每次生成的 <code>js</code> 文件名会有所不同，总不能让我们每次都人工去修改 <code>html</code>，这样不是显得我们很蠢嘛~</p>
<p>我们可以使用 <code>html-webpack-plugin</code> 插件来帮助我们完成这些事情。</p>
<p>首先，安装一下插件:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install html-webpack-plugin -D </span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>新建 <code>public</code> 目录，并在其中新建一个 <code>index.html</code> 文件( 文件内容使用 <code>html:5</code> 快捷生成即可)</p>
<p>修改 <code>webpack.config.js</code> 文件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//首先引入插件</span></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">//数组 放着所有的webpack插件</span></span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">'./public/index.html'</span>,</span><br><span class="line">            filename: <span class="string">'index.html'</span>, <span class="comment">//打包后的文件名</span></span><br><span class="line">            minify: &#123;</span><br><span class="line">                removeAttributeQuotes: <span class="literal">false</span>, <span class="comment">//是否删除属性的双引号</span></span><br><span class="line">                collapseWhitespace: <span class="literal">false</span>, <span class="comment">//是否折叠空白</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// hash: true //是否加上hash，默认是 false</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此时执行 <code>npx webpack</code>，可以看到 <code>dist</code> 目录下新增了 <code>index.html</code> 文件，并且其中自动插入了 `` 脚本，引入的是我们打包之后的 js 文件。</p>
<p>这里要多说一点点东西，<code>HtmlWebpackPlugin</code> 还为我们提供了一个 <code>config</code> 的配置，这个配置可以说是非常有用了。</p>
<h4 id="html-webpack-plugin-的-config-的妙用"><a href="#html-webpack-plugin-的-config-的妙用" class="headerlink" title="html-webpack-plugin 的 config 的妙用"></a>html-webpack-plugin 的 config 的妙用</h4><p>有时候，我们的脚手架不仅仅给自己使用，也许还提供给其它业务使用，<code>html</code> 文件的可配置性可能很重要，比如：你公司有专门的部门提供M页的公共头部/公共尾部，埋点jssdk以及分享的jssdk等等，但是不是每个业务都需要这些内容。</p>
<p>一个功能可能对应多个 <code>js</code> 或者是 <code>css</code> 文件，如果每次都是业务自行修改 <code>public/index.html</code> 文件，也挺麻烦的。首先他们得搞清楚每个功能需要引入的文件，然后才能对 <code>index.html</code> 进行修改。</p>
<p>此时我们可以增加一个配置文件，业务通过设置 <code>true</code> 或 <code>false</code> 来选出自己需要的功能，我们再根据配置文件的内容，为每个业务生成相应的 <code>html</code> 文件，岂不是美美的。</p>
<p>Let’s Go!</p>
<p>首先，我们在 <code>public</code> 目录下新增一个 <code>config.js</code> ( 文件名你喜欢叫什么就叫什么 )，将其内容设置为:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//public/config.js 除了以下的配置之外，这里面还可以有许多其他配置，例如,pulicPath 的路径等等</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    dev: &#123;</span><br><span class="line">        template: &#123;</span><br><span class="line">            title: <span class="string">'你好'</span>,</span><br><span class="line">            header: <span class="literal">false</span>,</span><br><span class="line">            footer: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    build: &#123;</span><br><span class="line">        template: &#123;</span><br><span class="line">            title: <span class="string">'你好才怪'</span>,</span><br><span class="line">            header: <span class="literal">true</span>,</span><br><span class="line">            footer: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，我们修改下我们的 <code>webpack.config.js</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> isDev = process.env.NODE_ENV === <span class="string">'development'</span>;</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">'./public/config'</span>)[isDev ? <span class="string">'dev'</span> : <span class="string">'build'</span>];</span><br><span class="line"></span><br><span class="line">modue.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    mode: isDev ? <span class="string">'development'</span> : <span class="string">'production'</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">'./public/index.html'</span>,</span><br><span class="line">            filename: <span class="string">'index.html'</span>, <span class="comment">//打包后的文件名</span></span><br><span class="line">            config: config.template</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>相应的，我们需要修改下我们的 <code>public/index.html</code> 文件(嵌入的js和css并不存在，仅作为示意)：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span>(<span class="attr">htmlWebpackPlugin.options.config.header</span>) &#123; %&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"//common/css/header.css"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;<span class="name">%=</span> (<span class="attr">htmlWebpackPlugin.options.config.title</span>) %&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> <span class="attr">if</span>(<span class="attr">htmlWebpackPlugin.options.config.header</span>) &#123; %&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"//common/header.min.js"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">%</span> &#125; %&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>process.env</code> 中默认并没有 <code>NODE_ENV</code>，这里配置下我们的 <code>package.json</code> 的 <code>scripts</code>.</p>
<p>为了兼容Windows和Mac，我们先安装一下 <code>cross-env</code>:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install cross-env -D</span><br></pre></td></tr></table></figure>

<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">        <span class="attr">"dev"</span>: <span class="string">"cross-env NODE_ENV=development webpack"</span>,</span><br><span class="line">        <span class="attr">"build"</span>: <span class="string">"cross-env NODE_ENV=production webpack"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们运行 <code>npm run dev</code> 和 运行 <code>npm run build</code> ，对比下 <code>dist/index.html</code> ，可以看到 <code>npm run build</code>，生成的 <code>index.html</code> 文件中引入了对应的 <code>css</code> 和 <code>js</code>。并且对应的 <code>title</code> 内容也不一样。</p>
<p>你说这里是不是非得是用 <code>NODE_ENV</code> 去判断？当然不是咯，你写 <code>aaa=1</code> ，<code>aaa=2</code> 都行（当然啦，<code>webpack.config.js</code> 和 <code>scripts</code> 都需要进行相应修改），但是可能会被后面接手的人打死。</p>
<p>更多<a href="https://github.com/jantimon/html-webpack-plugin#configuration" target="_blank" rel="noopener">html-webpack-plugin配置项</a></p>
<h4 id="如何在浏览器中实时展示效果"><a href="#如何在浏览器中实时展示效果" class="headerlink" title="如何在浏览器中实时展示效果"></a>如何在浏览器中实时展示效果</h4><p>说了这么多，到现在还没能在浏览器中实时查看效果，是不是已经有点捉急了，先看一下如何实时查看效果吧，不然都不知道自己配得对不对。</p>
<p>话不多说，先装依赖:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-dev-server -D</span><br></pre></td></tr></table></figure>

<p>修改下咱们的 <code>package.json</code> 文件的 <code>scripts</code>：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">"scripts": &#123;</span><br><span class="line">    "dev": "cross-env NODE_ENV=development webpack-dev-server",</span><br><span class="line">    "build": "cross-env NODE_ENV=production webpack"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在控制台执行 <code>npm run dev</code>，启动正常，页面上啥也没有，修改下我们的JS代码，往页面中增加点内容，正常刷新(也就是说不需要进行任何配置就可以使用了)。</p>
<p>Excuse me。怪我平时不认真咯，每次都乖乖的配个 <code>contentBase</code>，原来根本不需要配，带着疑问，我又去搜寻了一番。</p>
<p>原来在配置了 <code>html-webpack-plugin</code> 的情况下， <code>contentBase</code> 不会起任何作用，也就是说我以前都是白配了，这是一个悲伤的故事。</p>
<p>不过呢，我们还是可以在 <code>webpack.config.js</code> 中进行 <code>webpack-dev-server</code> 的其它配置，例如指定端口号，设置浏览器控制台消息，是否压缩等等:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    devServer: &#123;</span><br><span class="line">        port: <span class="string">'3000'</span>, <span class="comment">//默认是8080</span></span><br><span class="line">        quiet: <span class="literal">false</span>, <span class="comment">//默认不启用</span></span><br><span class="line">        inline: <span class="literal">true</span>, <span class="comment">//默认开启 inline 模式，如果设置为false,开启 iframe 模式</span></span><br><span class="line">        stats: <span class="string">"errors-only"</span>, <span class="comment">//终端仅打印 error</span></span><br><span class="line">        overlay: <span class="literal">false</span>, <span class="comment">//默认不启用</span></span><br><span class="line">        clientLogLevel: <span class="string">"silent"</span>, <span class="comment">//日志等级</span></span><br><span class="line">        compress: <span class="literal">true</span> <span class="comment">//是否启用 gzip 压缩,</span></span><br><span class="line">        hot: <span class="literal">true</span>, <span class="comment">// 是否启用热更新，默认为false</span></span><br><span class="line">        open: <span class="literal">true</span> <span class="comment">// 服务启动后是否自动打开浏览器 </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启用 <code>quiet</code> 后，除了初始启动信息之外的任何内容都不会被打印到控制台。这也意味着来自 <code>webpack</code> 的错误或警告在控制台不可见 ———— 我是不会开启这个的，看不到错误日志，还搞个锤子</p>
<p><code>stats</code>: “errors-only” ， 终端中仅打印出 <code>error</code>，注意当启用了 <code>quiet</code> 或者是 <code>noInfo</code> 时，此属性不起作用。 ————— 这个属性个人觉得很有用，尤其是我们启用了 <code>eslint</code> 或者使用 <code>TS</code>进行开发的时候，太多的编译信息在终端中，会干扰到我们。</p>
<p>启用 <code>overlay</code> 后，当编译出错时，会在浏览器窗口全屏输出错误，默认是关闭的。</p>
<hr>
<p>此处有图</p>
<hr>
<p><code>clientLogLevel</code>: 当使用内联模式时，在浏览器的控制台将显示消息，如：在重新加载之前，在一个错误之前，或者模块热替换启用时。如果你不喜欢看这些信息，可以将其设置为 <code>silent</code> (<code>none</code> 即将被移除)。</p>
<hr>
<p>此处有图</p>
<hr>
<p>本篇文章不是为了细说 <code>webpack-dev-server</code> 的配置，所以这里就不多说了。关于 <code>webpack-dev-server</code> 更多的配置可以<a href="https://webpack.js.org/configuration/dev-server/" target="_blank" rel="noopener">点击查看</a>。</p>
<p>细心的小伙伴可能发现了一个小问题，我们在<code>src/index.js</code>中增加一句 <code>console.log(&#39;aaa&#39;)</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    getName() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> dog = <span class="keyword">new</span> Animal(<span class="string">'dog'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'aaa'</span>);</span><br></pre></td></tr></table></figure>

<p>然后通过 <code>npm run dev</code> 查看效果，会发现：</p>
<hr>
<p>此处有图</p>
<hr>
<p>这显然不是我们源码中对应的行号，点进去的话，会发现代码是被编译后的，我当前的代码非常简单，还能看出来，项目代码复杂后，“亲妈”看编译后都费劲，这不利于我们开发调试，不是我们想要的，我们肯定还是希望能够直接对应到源码的。</p>
<h3 id="7-devtool"><a href="#7-devtool" class="headerlink" title="7.devtool"></a>7.devtool</h3><p><code>devtool</code> 中的一些设置，可以帮助我们将编译后的代码映射回原始源代码。不同的值会明显影响到构建和重新构建的速度。</p>
<p>对我而言，能够定位到源码的行即可，因此，综合构建速度，在开发模式下，我设置的 <code>devtool</code> 的值是 <code>cheap-module-eval-source-map</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    devtool: <span class="string">'cheap-module-eval-source-map'</span> <span class="comment">//开发环境下使用  可以看到源代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>生产环境可以使用 <code>none</code> 或者是 <code>source-map</code>，使用 <code>source-map</code> 最终会单独打包出一个 <code>.map</code> 文件，我们可以根据报错信息和此 <code>map</code> 文件，进行错误解析，定位到源代码。</p>
<p><code>source-map</code> 和 <code>hidden-source-map</code> 都会打包生成单独的 <code>.map</code> 文件，区别在于，<code>source-map</code> 会在打包出的js文件中增加一个引用注释，以便开发工具知道在哪里可以找到它。<code>hidden-source-map</code> 则不会在打包的js中增加引用注释。</p>
<p>但是我们一般不会直接将 <code>.map</code> 文件部署到CDN，因为会直接映射到源码，更希望将<code>.map</code> 文件传到错误解析系统，然后根据上报的错误信息，直接解析到出错的源码位置。</p>
<p>还可以设置其他的<a href="http://webpack.html.cn/configuration/devtool.html" target="_blank" rel="noopener">devtool值</a>，你可以使用不同的值，构建对比差异。</p>
<p>现在我们已经说了 <code>html</code>、<code>js</code> 了，并且也可以在浏览器中实时看到效果了，现在就不得不说页面开发三巨头之一的 <code>css</code> 。</p>
<h3 id="8-如何处理样式文件呢"><a href="#8-如何处理样式文件呢" class="headerlink" title="8.如何处理样式文件呢"></a>8.如何处理样式文件呢</h3><p><code>webpack</code> 不能直接处理 <code>css</code>，需要借助 <code>loader</code>。如果是 <code>.css</code>，我们需要的 <code>loader</code> 通常有： <code>style-loader</code>、<code>css-loader</code>，考虑到兼容性问题，还需要 <code>postcss-loader</code>，而如果是 <code>less</code> 或者是 <code>sass</code> 的话，还需要 <code>less-loader</code> 和 <code>sass-loader</code>，这里配置一下 <code>less</code> 和 <code>css</code> 文件(<code>sass</code> 的话，使用 <code>sass-loader</code>即可):</p>
<p>先安装一下需要使用的依赖:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install style-loader less-loader css-loader postcss-loader autoprefixer less -D</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(le|c)ss$/</span>,</span><br><span class="line">                use: [<span class="string">'style-loader'</span>, <span class="string">'css-loader'</span>, &#123;</span><br><span class="line">                    loader: <span class="string">'postcss-loader'</span>,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        plugins: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">                            <span class="keyword">return</span> [</span><br><span class="line">                                <span class="built_in">require</span>(<span class="string">'autoprefixer'</span>)(&#123;</span><br><span class="line">                                    <span class="string">"overrideBrowserslist"</span>: [</span><br><span class="line">                                        <span class="string">"&gt;0.25%"</span>,</span><br><span class="line">                                        <span class="string">"not dead"</span></span><br><span class="line">                                    ]</span><br><span class="line">                                &#125;)</span><br><span class="line">                            ]</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;, <span class="string">'less-loader'</span>],</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//src/index.less</span></span><br><span class="line"><span class="variable">@color:</span> red;</span><br><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">    <span class="attribute">background</span>: <span class="variable">@color</span>;</span><br><span class="line">    <span class="attribute">transition</span>: all <span class="number">2s</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再在入口文件中引入此 <code>less</code>:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//src/index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">'./index.less'</span>;</span><br></pre></td></tr></table></figure>

<p>我们修改了配置文件，重新启动一下服务: <code>npm run dev</code>。可以看到页面的背景色变成了红色。</p>
<p>OK，我们简单说一下上面的配置：</p>
<ul>
<li><code>style-loader</code> 动态创建 <code>style</code> 标签，将 <code>css</code> 插入到 <code>head</code> 中.</li>
<li><code>css-loader</code> 负责处理 <code>@import</code> 等语句。</li>
<li><code>postcss-loader</code> 和 <code>autoprefixer</code>，自动生成浏览器兼容性前缀 —— 2020了，应该没人去自己徒手去写浏览器前缀了吧</li>
<li><code>less-loader</code> 负责处理编译 <code>.less</code> 文件,将其转为 <code>css</code></li>
</ul>
<p>这里，我们之间在 <code>webpack.config.js</code> 写了 <code>autoprefixer</code> 需要兼容的浏览器，仅是为了方便展示。推荐大家在根目录下创建 <code>.browserslistrc</code>，将对应的规则写在此文件中，除了 <code>autoprefixer</code> 使用外，<code>@babel/preset-env</code>、<code>stylelint</code>、<code>eslint-plugin-conmpat</code> 等都可以共用。</p>
<p><strong>注意</strong></p>
<p><code>loader</code>的执行顺序是从右向左执行的，也就是后面的 <code>loader</code> 先执行，上边的 <code>loader</code> 的执行顺序为 <code>less-loader</code>—-&gt; <code>postcss-loader</code> —-&gt; <code>css-loader</code> —-&gt; <code>style-loader</code></p>
<p>当然，<code>loader</code> 其实还有一个参数，可以修改优先级，<code>enforce</code> 参数，其值可以为: <code>pre</code>(优先执行) 或 <code>post</code> (滞后执行)。</p>
<p>现在，我们已经可以处理 <code>.less</code> 文件啦，<code>.css</code> 文件只需要修改匹配规则，删除 <code>less-loader</code> 即可。</p>
<p>现在的一切看起来都很完美，但是假设我们的文件中使用了本地的图片，例如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">body&#123;</span><br><span class="line">    backgroud: url(<span class="string">'../images/thor.png'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>你就会发现，报错啦啦啦，那么我们要怎么处理图片或是本地的一些其它资源文件呢。不用想，肯定又需要 <code>loader</code> 出马了。</p>
<h3 id="9-图片-字体文件处理"><a href="#9-图片-字体文件处理" class="headerlink" title="9.图片/字体文件处理"></a>9.图片/字体文件处理</h3><p>我们可以使用 <code>url-loader</code> 或者 <code>file-loader</code> 来处理本地的资源文件。<code>url-loader</code> 和 <code>file-loader</code> 的功能类似，但是 <code>url-loader</code> 可以指定在文件大小小于指定的限制时，返回 <code>DataURL</code>，因此，个人会优先选择使用 <code>url-loader</code>。</p>
<p>首先安装依赖:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install url-loader -D</span><br></pre></td></tr></table></figure>

<p>安装 <code>url-loader</code> 的时候，控制台会提示你，还需要安装下 <code>file-loader</code>，听人家的话安装下就行(新版 <code>npm</code> 不会自动安装 <code>peerDependencies</code>)：</p>
<hr>
<p>此处有图</p>
<hr>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install file-loader -D</span><br></pre></td></tr></table></figure>

<p>在 <code>webpack.config.js</code> 中进行配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    modules: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(png|jpg|gif|jpeg|webp|svg|eot|ttf|woff|woff2)$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'url-loader'</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            limit: <span class="number">10240</span>, <span class="comment">//10K</span></span><br><span class="line">                            esModule: <span class="literal">false</span> </span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ],</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此处设置 <code>limit</code> 的值大小为 10240，即资源大小小于 <code>10K</code> 时，将资源转换为 <code>base64</code>，超过 10K，将图片拷贝到 <code>dist</code> 目录。<code>esModule</code> 设置为 <code>false</code>，否则会出现 <code>&lt;img src=&quot;require(&#39;xxx.jpg&#39;)/&gt;&quot;</code> 或者 <code>&lt;img src=[Module Object] /&gt;</code></p>
<p>将资源转换为 <code>base64</code> 可以减少网络请求次数，但是 <code>base64</code> 数据较大，如果太多的资源是 <code>base64</code>，会导致加载变慢，因此设置 <code>limit</code> 值时，需要二者兼顾。</p>
<p>默认情况下，生成的文件的文件名就是文件内容的 <code>MD5</code> 哈希值并会保留所引用资源的原始扩展名，例如我上面的图片(thor.jpeg)对应的文件名如下：</p>
<hr>
<p>此处有图</p>
<hr>
<p>当然，你也可以通过 <code>options</code> 参数进行修改。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//....</span></span><br><span class="line">use: [</span><br><span class="line">    &#123;</span><br><span class="line">        loader: <span class="string">'url-loader'</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">            limit: <span class="number">10240</span>, <span class="comment">//10K</span></span><br><span class="line">            esModule: <span class="literal">false</span>,</span><br><span class="line">            name: <span class="string">'[name]_[hash:6].[ext]'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>重新编译，在浏览器中审查元素，可以看到图片名变成了: <code>thor_a5f7c0.jpeg</code>。</p>
<p>当本地资源较多时，我们有时会希望它们能打包在一个文件夹下，这也很简单，我们只需要在 <code>url-loader</code> 的 <code>options</code> 中指定 <code>outpath</code>，如: <code>outputPath: &#39;assets&#39;</code>，构建出的目录如下:</p>
<hr>
<p>此处有图</p>
<hr>
<p>更多的 <code>url-loader</code> 配置可以<a href="https://www.webpackjs.com/loaders/url-loader/" target="_blank" rel="noopener">查看</a></p>
<p>到了这里，有点<strong>岁月静好</strong>的感觉了。</p>
<p>不过还没完，如果你在 <code>public/index.html</code> 文件中，使用本地的图片，例如，我们修改一下 <code>public/index.html</code>：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"./a.jpg"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>重启本地服务，虽然，控制台不会报错，但是你会发现，浏览器中根本加载不出这张图片，Why？因为构建之后，通过相对路径压根找不着这张图片呀。</p>
<p>How？怎么解决呢？</p>
<h3 id="10-处理-html-中的本地图片"><a href="#10-处理-html-中的本地图片" class="headerlink" title="10.处理 html 中的本地图片"></a>10.处理 html 中的本地图片</h3><p>安装 <code>html-withimg-loader</code> 来解决咯。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install html-withimg-loader -D</span><br></pre></td></tr></table></figure>

<p>修改 <code>webpack.config.js</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/.html$/</span>,</span><br><span class="line">                use: <span class="string">'html-withimg-loader'</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后在我们的 <code>html</code> 中引入一张文件测试一下（图片地址自己写咯，这里只是示意）:</p>
<p>重启本地服务，图片并没能加载，审查元素的话，会发现图片的地址显示的是 <code>{&quot;default&quot;:&quot;assets/thor_a5f7c0.jpeg&quot;}</code>。</p>
<p>我当前 <code>file-loader</code> 的版本是 5.0.2，5版本之后，需要增加 <code>esModule</code> 属性：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    modules: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.(png|jpg|gif|jpeg|webp|svg|eot|ttf|woff|woff2)$/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">'url-loader'</span>,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            limit: <span class="number">10240</span>, <span class="comment">//10K</span></span><br><span class="line">                            esModule: <span class="literal">false</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再重启本地服务，就搞定啦。</p>
<p>话说使用 <code>html-withimg-loader</code> 处理图片之后，<code>html</code> 中就不能使用 <code>vm</code>, <code>ejs</code> 的模板了，如果想继续在 <code>html</code> 中使用 <code>&lt;% if(htmlWebpackPlugin.options.config.header) { %&gt;</code> 这样的语法，但是呢，又希望能使用本地图片，可不可以？鱼和熊掌都想要，虽然很多时候，能吃个鱼就不错了，但是这里是可以的哦，像下面这样编写图片的地址，并且删除<code>html-withimg-loader</code>的配置即可。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"&lt;%= require('./thor.jpeg') %&gt;"</span> /&gt;</span></span><br></pre></td></tr></table></figure>

<p>图片加载OK啦，并且 <code>&lt;% %&gt;</code> 语法也可以正常使用，吼吼吼<del>~</del></p>
<p>虽然，<code>webpack</code> 的默认配置很好用，但是有的时候，我们会有一些其它需要啦，例如，我们不止一个入口文件，这时候，该怎么办呢？</p>
<h3 id="11-入口配置"><a href="#11-入口配置" class="headerlink" title="11.入口配置"></a>11.入口配置</h3><p>入口的字段为: <code>entry</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/index.js'</span> <span class="comment">//webpack的默认配置</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>entry</code> 的值可以是一个字符串，一个数组或是一个对象。</p>
<p>字符串的情况无需多说，就是以对应的文件为入口。</p>
<p>为数组时，表示有“多个主入口”，想要多个依赖文件一起注入时，会这样配置。例如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">entry: [</span><br><span class="line">    <span class="string">'./src/polyfills.js'</span>,</span><br><span class="line">    <span class="string">'./src/index.js'</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p><code>polyfills.js</code> 文件中可能只是简单的引入了一些 <code>polyfill</code>，例如 <code>babel-polyfill</code>，<code>whatwg-fetch</code> 等，需要在最前面被引入（我在 webpack2 时这样配置过）。</p>
<p>那什么时候是对象呢？不要捉急，后面将多页配置的时候，会说到。</p>
<h3 id="12-出口配置"><a href="#12-出口配置" class="headerlink" title="12.出口配置"></a>12.出口配置</h3><p>配置 <code>output</code> 选项可以控制 <code>webpack</code> 如何输出编译文件。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>), <span class="comment">//必须是绝对路径</span></span><br><span class="line">        filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">        publicPath: <span class="string">'/'</span> <span class="comment">//通常是CDN地址</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例如，你最终编译出来的代码部署在 CDN 上，资源的地址为: ‘<a href="https://AAA/BBB/YourProject/XXX&#39;，那么可以将生产的" target="_blank" rel="noopener">https://AAA/BBB/YourProject/XXX&#39;，那么可以将生产的</a> <code>publicPath</code> 配置为: <code>//AAA/BBB/</code>。</p>
<p>编译时，可以不配置，或者配置为 <code>/</code>。可以在我们之前提及的 <code>config.js</code> 中指定 <code>publicPath</code>（<code>config.js</code> 中区分了 <code>dev</code> 和 <code>public</code>）， 当然还可以区分不同的环境指定配置文件来设置，或者是根据 <code>isDev</code> 字段来设置。</p>
<p>除此之外呢，考虑到CDN缓存的问题，我们一般会给文件名加上 <code>hash</code>.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>), <span class="comment">//必须是绝对路径</span></span><br><span class="line">        filename: <span class="string">'bundle.[hash].js'</span>,</span><br><span class="line">        publicPath: <span class="string">'/'</span> <span class="comment">//通常是CDN地址</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果你觉得 <code>hash</code> 串太长的话，还可以指定长度，例如 <code>bundle.[hash:6].js</code>。使用 <code>npm run build</code> 打包看看吧。</p>
<p>问题出现啦，每次文件修改后，重新打包，导致 <code>dist</code> 目录下的文件越来越多。要是每次打包前，都先清空一下目录就好啦。可不可以做到呢？必须可以！</p>
<h3 id="13-每次打包前清空dist目录"><a href="#13-每次打包前清空dist目录" class="headerlink" title="13.每次打包前清空dist目录"></a>13.每次打包前清空dist目录</h3><p>反正我是懒得手动去清理的，只要你足够懒，你总是会找到好办法的，懒人推动科技进步。这里，我们需要插件: <code>clean-webpack-plugin</code></p>
<p>安装依赖:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install clean-webpack-plugin -D</span><br></pre></td></tr></table></figure>

<p>以前，<code>clean-webpack-plugin</code> 是默认导出的，现在不是，所以引用的时候，需要注意一下。另外，现在构造函数接受的参数是一个对象，可缺省。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; CleanWebpackPlugin &#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="comment">//不需要传参数喔，它可以找到 outputPath</span></span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin() </span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在你再修改文件，重现构建，生成的hash值和之前dist中的不一样，但是因为每次 <code>clean-webpack-plugin</code> 都会帮我们先清空一波 <code>dist</code> 目录，所以不会出现太多文件，傻傻分不清楚究竟哪个是新生成文件的情况。</p>
<h4 id="希望dist目录下某个文件夹不被清空"><a href="#希望dist目录下某个文件夹不被清空" class="headerlink" title="希望dist目录下某个文件夹不被清空"></a>希望dist目录下某个文件夹不被清空</h4><p>不过呢，有些时候，我们并不希望整个 <code>dist</code> 目录都被清空，比如，我们不希望，每次打包的时候，都删除 <code>dll</code> 目录，以及 <code>dll</code> 目录下的文件或子目录，该怎么办呢？</p>
<p><code>clean-webpack-plugin</code> 为我们提供了参数 <code>cleanOnceBeforeBuildPatterns</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//webpack.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">//...</span></span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin(&#123;</span><br><span class="line">            cleanOnceBeforeBuildPatterns:[<span class="string">'**/*'</span>, <span class="string">'!dll'</span>, <span class="string">'!dll/**'</span>] <span class="comment">//不删除dll目录下的文件</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>此外，<code>clean-webpack-plugin</code> 还有一些其它的配置，不过我使用的不多，大家可以查看<a href="https://github.com/johnagan/clean-webpack-plugin" target="_blank" rel="noopener">clean-webpack-plugin</a></p>
<p>至此，我们算是完成了一个基础配置。但是这不够完美，或者说有些时候，我们还会有一些其它的需求。下一篇关于<code>webpack</code>配置的文章会介绍一些其它的情况。</p>
<blockquote>
<p>参考资料</p>
</blockquote>
<ul>
<li><a href="https://nodejs.org/en/blog/npm/peer-dependencies/" target="_blank" rel="noopener">Peer Dependencies</a></li>
<li><a href="https://www.npmjs.com/package/html-webpack-plugin" target="_blank" rel="noopener">html-webpack-plugin</a></li>
<li><a href="https://www.webpackjs.com/concepts/" target="_blank" rel="noopener">webpack中文文档</a></li>
</ul>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://niuxinyu.github.io/niuxinyublog/niuxinyublog/2020/06/27/vue将父组件中的props全部传递到子组件的写法/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Niu">
      <meta itemprop="description" content="文章">
      <meta itemprop="image" content="/niuxinyublog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niu的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/niuxinyublog/2020/06/27/vue将父组件中的props全部传递到子组件的写法/" class="post-title-link" itemprop="url">vue将父组件中的props全部传递到子组件的写法</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2020-06-27 19:21:57 / 修改时间：22:30:56" itemprop="dateCreated datePublished" datetime="2020-06-27T19:21:57+08:00">2020-06-27</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="vue父组件内将props全部传递到子组件的写法"><a href="#vue父组件内将props全部传递到子组件的写法" class="headerlink" title="vue父组件内将props全部传递到子组件的写法"></a><code>vue</code>父组件内将props全部传递到子组件的写法</h2><blockquote>
<p>以下的 <code>vue</code> 版本为 <code>2.6.0</code>以上</p>
</blockquote>
<p>在组件分割中，<code>props</code> 的传递是频繁的，同时，跨层级的 <code>props</code> 传递也是时常发生的</p>
<h2 id="父组件将接收的-props-全部直接传递给子组件"><a href="#父组件将接收的-props-全部直接传递给子组件" class="headerlink" title="父组件将接收的 props 全部直接传递给子组件"></a>父组件将接收的 <code>props</code> 全部直接传递给子组件</h2><p>可以直接使用 <code>vm.$attrs</code> 进行值得传递，举例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">// 顶层组件</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div id=&quot;app&quot;&gt;</span><br><span class="line">    &lt;parent name=&quot;牛鑫宇&quot; :age=&quot;18&quot; sex=&quot;男&quot;&gt;&lt;/parent&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import Parent from &quot;./components/parent&quot;;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;App&quot;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    Parent</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">// 中间组件 相当于父组件</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h1&gt;这是父组件&lt;/h1&gt;</span><br><span class="line">    &lt;son v-bind=&quot;$attrs&quot;&gt;&lt;/son&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">import Son from &quot;./son&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;parent&quot;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    name: String,</span><br><span class="line">    age: Number</span><br><span class="line">  &#125;,</span><br><span class="line">  components: &#123;</span><br><span class="line">    Son</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">// 底层需要是使用props得组件 相当于子组件</span><br><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;h2&gt;这是子组件&lt;/h2&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;son&quot;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    name: String,</span><br><span class="line">    age: Number,</span><br><span class="line">    sex: String</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    console.log(this.name, this.age, this.sex);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p><code>$attrs</code> 是 <code>2.6.0</code> 版本新增得功能，可以将中间组件内没有通过 <code>props</code> 接收得值传递到下一级</p>
<p><a href="https://cn.vuejs.org/v2/api/#vm-attrs" target="_blank" rel="noopener">$attrs</a></p>
<p>在 <code>jsx</code> 中，解决这个问题得方式比较多样</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://niuxinyu.github.io/niuxinyublog/niuxinyublog/2020/06/27/vue-jsx写法中得render函数得执行时机问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Niu">
      <meta itemprop="description" content="文章">
      <meta itemprop="image" content="/niuxinyublog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niu的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/niuxinyublog/2020/06/27/vue-jsx写法中得render函数得执行时机问题/" class="post-title-link" itemprop="url">vue jsx写法中得render函数得执行时机问题</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2020-06-27 19:20:55 / 修改时间：22:30:49" itemprop="dateCreated datePublished" datetime="2020-06-27T19:20:55+08:00">2020-06-27</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="vue-jsx写法中得render函数得执行时机问题"><a href="#vue-jsx写法中得render函数得执行时机问题" class="headerlink" title="vue jsx写法中得render函数得执行时机问题"></a>vue jsx写法中得render函数得执行时机问题</h1><p>执行时机如下</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">"render"</span>,</span><br><span class="line">    beforeCreate() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"----beforeCreate----"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"----created----"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    beforeMount() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"----beforeMount----"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"----mounted----"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    render() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"----render----"</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>这是render函数<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line"><span class="comment">// 执行结果</span></span><br><span class="line">----beforeCreate----</span><br><span class="line">----created----</span><br><span class="line">----beforeMount----</span><br><span class="line">----render----</span><br><span class="line">----mounted----</span><br></pre></td></tr></table></figure>


        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://niuxinyu.github.io/niuxinyublog/niuxinyublog/2020/06/27/vue-jsx开发不完全指南/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Niu">
      <meta itemprop="description" content="文章">
      <meta itemprop="image" content="/niuxinyublog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niu的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/niuxinyublog/2020/06/27/vue-jsx开发不完全指南/" class="post-title-link" itemprop="url">vue jsx开发不完全指南</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2020-06-27 19:20:26 / 修改时间：22:30:38" itemprop="dateCreated datePublished" datetime="2020-06-27T19:20:26+08:00">2020-06-27</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Vue中jsx不完全应用指南"><a href="#Vue中jsx不完全应用指南" class="headerlink" title="Vue中jsx不完全应用指南"></a>Vue中jsx不完全应用指南</h1><p><strong><code>vue cli3.x</code> 以上的版本自带 <code>jsx</code> 解析配置</strong></p>
<p>在使用Vue开发项目时绝大多数情况下都是使用模板来写HTML，但是有些时候页面复杂又存在各种条件判断来显示/隐藏和拼凑页面内容，或者页面中很多部分存在部分DOM结构一样的时候就略显捉襟见肘，会写大量重复的代码，会出现单个<code>.vue</code>文件过长的情况，这个时候我们就需要更多的代码控制，这时候可以使用<strong>渲染函数</strong>。</p>
<p>渲染函数想必平时几乎没有人去写，因为写起来很痛苦（本人也没有写过）。更多的是在Vue中使用JSX语法。写法上和在React中差不多，但是功能上还是没有React中那么完善。</p>
<p>在写JSX的过程中不得考虑一个样式的问题，虽然可以直接在<code>.vue</code>文件中不写<code>部分，只写</code>和``部分，而不用担心样式作用域问题。但是更多的时候还是推荐直接使用<code>.js</code>的方式来写组件，这个时候就涉及到样式作用域的问题了。</p>
<p>在React的生态中，有很多<strong>CSS-IN-JS</strong>的解决方案，比如<strong>styled-jsx</strong>、<strong>emotion</strong>、<strong>styled-components</strong>等，目前最活跃和用户量最多的是styled-components，目前已经拥有良好的生态圈子。如果需要在样式中作一些像Sass/Less中的颜色计算，可以使用<a href="https://github.com/styled-components/polished" target="_blank" rel="noopener">polished</a>来实现，当然不止这么简单的功能。但是在Vue中可使用的方案就太少了，因为Vue使用模板来写HTML本身是开箱即用的样式<code>scoped</code>，在使用JSX写组件的时候就面临着样式问题，一种方案是在组件包裹``中取一个特殊的名字，然后样式都嵌套写在这个class下面，但是难免会遇到命名冲突的情况，而且每次还得变着花样取名称。此外，就是引入CSS-IN-JS在Vue对应的实现，但目前来看Styled-components官方提供了一个Vue版本的叫<a href="https://github.com/styled-components/vue-styled-components" target="_blank" rel="noopener">vue-styled-components</a>和emotion的<a href="https://github.com/sky-foundry/vue-emotion" target="_blank" rel="noopener">vue-emotion</a>，但是用的人实在太少。像styled-components进行了重大更新和变化，但是Vue版本的还是最初的版本，而且有时候还出现样式不生效的情况。</p>
<p>接下来进入正题，从简单语法到经验分享（大牛请绕行）</p>
<h2 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h2><p>首先需要约定一下，使用JSX组件命名采用首字母大写的驼峰命名方式，样式可以少的可以直接基于vue-styled-components写在同一个文件中，复杂的建议放在单独的_Styles.js_文件中，当然也可以不采用CSS-IN-JS的方式，使用Less/Sass来写，然后在文件中import进来。</p>
<p>下面是一个通用的骨架：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> styled <span class="keyword">from</span> <span class="string">'vue-styled-components'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Container = styled.div<span class="string">`</span></span><br><span class="line"><span class="string">    heigth: 100%;</span></span><br><span class="line"><span class="string">`</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Dashboard = &#123;</span><br><span class="line">  name: <span class="string">'Dashboard'</span>,</span><br><span class="line">  </span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;Container&gt;内容&lt;<span class="regexp">/Container&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">export default Dashboard</span></span><br></pre></td></tr></table></figure>

<p><strong>在<code>vue.cli 3.x</code>中不需要这样，直接将样式文件命名为 <code>xxx.module.css</code>就可以解决样式作用域问题了</strong></p>
<h3 id="插值"><a href="#插值" class="headerlink" title="插值"></a>插值</h3><p>在JSX中使用单个括号来绑定文本插值</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;span&gt;Message: &#123;<span class="keyword">this</span>.messsage&#125;&lt;<span class="regexp">/span&gt;</span></span><br><span class="line"><span class="regexp">&lt;!-- 类似于v-html --&gt;</span></span><br><span class="line"><span class="regexp">&lt;div domPropsInnerHTML=&#123;this.dangerHtml&#125;/</span>&gt;</span><br><span class="line">&lt;!-- v-model --&gt;</span><br><span class="line">&lt;el-input v-model=&#123;<span class="keyword">this</span>.vm.name&#125; /&gt;</span><br></pre></td></tr></table></figure>

<p>在<code>jsx</code>中不需要把<code>v-model</code>分成事件绑定和赋值二部分分开来写，因为有相应的babel插件来专门处理。</p>
<p><strong>实际上在使用过程中，<code>v-model</code> 不可以直接使用，需要查分开来写</strong></p>
<p>简单的 <code>v-model</code> 实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> nInput = &#123;</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;input @input='handleInputChange' /&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">    props: &#123;</span><br><span class="line">        value: <span class="built_in">String</span></span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        handleInputChange (e) &#123;</span><br><span class="line">            <span class="keyword">this</span>.$emit(<span class="string">'input'</span>, e.target.value)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App = &#123;</span><br><span class="line">    template: <span class="string">`</span></span><br><span class="line"><span class="string">        &lt;div class='App'&gt;</span></span><br><span class="line"><span class="string">            &lt;h1&gt;App&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            &lt;n-input v-model='val'&gt;&lt;/n-input&gt;</span></span><br><span class="line"><span class="string">            &#123;&#123;val&#125;&#125;</span></span><br><span class="line"><span class="string">        &lt;/div&gt;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line">    components: &#123;</span><br><span class="line">        nInput</span><br><span class="line">    &#125;,</span><br><span class="line">    data () &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            val: <span class="string">''</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> Vue(&#123;</span><br><span class="line">    el: <span class="string">'#app'</span>,</span><br><span class="line">    render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="样式"><a href="#样式" class="headerlink" title="样式"></a>样式</h3><p>在JSX中可以直接使用<code>class=&quot;xx&quot;</code>来指定样式类，内联样式可以直接写成<code>style=&quot;xxx&quot;</code></p>
<p>在<code>vue</code> 中类名和 <code>react</code> 中的类名定义是不同的，<code>vue</code> 中是直接写为 <code>class=&#39;xxx&#39;</code>, <code>react</code> 中的写法是 <code>className=&#39;xxx&#39;</code> </p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"btn btn-default"</span> style=<span class="string">"font-size: 12px;"</span>&gt;Button&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;!-- 动态指定 --&gt;</span></span><br><span class="line"><span class="regexp">&lt;div class=&#123;`btn btn-$&#123;this.isDefault ? 'default' : ''&#125;`&#125;&gt;&lt;/</span>div&gt;</span><br><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=&#123;&#123;<span class="string">'btn-default'</span>: <span class="keyword">this</span>.isDefault, <span class="string">'btn-primary'</span>: <span class="keyword">this</span>.isPrimary&#125;&#125;&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;div style=&#123;&#123;color: 'red', fontSize: '14px'&#125;&#125;&gt;&lt;/</span>div&gt;</span><br></pre></td></tr></table></figure>

<h3 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h3><p>在JSX中没有<code>v-for</code>和<code>v-if</code>等指令的存在，这些全部需要采用Js的方式来实现</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="comment">/* 类似于v-if */</span>&#125;</span><br><span class="line">&#123;<span class="keyword">this</span>.withTitle &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">Title</span> /&gt;</span></span>&#125;</span><br><span class="line"></span><br><span class="line">&#123;<span class="comment">/* 类似于v-if 加 v-else */</span>&#125;</span><br><span class="line">&#123;<span class="keyword">this</span>.isSubTitle ? <span class="xml"><span class="tag">&lt;<span class="name">SubTitle</span> /&gt;</span></span> : <span class="xml"><span class="tag">&lt;<span class="name">Title</span> /&gt;</span></span>&#125;</span><br><span class="line"></span><br><span class="line">&#123;<span class="comment">/* 类似于v-for */</span>&#125;</span><br><span class="line">&#123;<span class="keyword">this</span>.options.map(<span class="function"><span class="params">option</span> =&gt;</span> &#123;</span><br><span class="line">  &lt;div&gt;&#123;option.title&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&#125;)&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="事件绑定"><a href="#事件绑定" class="headerlink" title="事件绑定"></a>事件绑定</h3><p>事件绑定需要在事件名称前端加上<code>on</code>前缀，原生事件添加<code>nativeOn</code></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 对应@click --&gt;</span><br><span class="line">&lt;el-buton onClick=&#123;<span class="keyword">this</span>.handleClick&#125;&gt;Click me&lt;<span class="regexp">/el-buton&gt;</span></span><br><span class="line"><span class="regexp">&lt;!-- 对应@click.native --&gt;</span></span><br><span class="line"><span class="regexp">&lt;el-button nativeOnClick=&#123;this.handleClick&#125;&gt;Native click&lt;/</span>el-button&gt;</span><br><span class="line">&lt;!-- 传递参数 --&gt;</span><br><span class="line">&lt;el-button onClick=&#123;e =&gt; <span class="keyword">this</span>.handleClick(<span class="keyword">this</span>.id)&#125;&gt;Click and pass data&lt;<span class="regexp">/el-button&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：如果需要给事件处理函数传参数，需要使用箭头函数来实现。如果不使用箭头函数那么接收的将会是事件的对象<code>event</code>属性。</p>
<h2 id="高级部分"><a href="#高级部分" class="headerlink" title="高级部分"></a>高级部分</h2><p>在Vue中基于jsx也可以把组件拆分成一个个小的函数式组件，但是有一个限制是必需有一个外层的包裹元素，不能直接写类似：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">    &lt;li&gt;One&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">  &lt;li&gt;Two&lt;/</span>li&gt;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>必需写成：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;li&gt;One&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">    &lt;li&gt;Two&lt;/</span>li&gt;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure>

<p>而在React中可以使用空标签<code>&lt;&gt;</code>和``来实现包裹元素，这里的空标签其实只是<code>react.Fragment</code>的一个语法糖。同时在React 16中直接支持返回数组的形式：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> [</span><br><span class="line">  &lt;li&gt;One&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">  &lt;li&gt;Two&lt;/</span>li&gt;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>那么在Vue中就只能通过遍历来实现类似的功能，大体思路就是把数据先定义好数据然后直接一个<code>map</code>生成，当然如果说元素的标签是不同类型的那就需要额外添加标识来判断了。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      options: [<span class="string">'one'</span>, <span class="string">'two'</span>]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">    </span><br><span class="line">    render() &#123;</span><br><span class="line">    <span class="keyword">const</span> LiItem = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.options.map(<span class="function"><span class="params">option</span> =&gt;</span> <span class="xml"><span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;option&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span>)</span><br><span class="line">                                          </span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">            &lt;ul&gt;</span><br><span class="line">              &lt;LiItem /&gt;</span><br><span class="line">          &lt;<span class="regexp">/ul&gt;</span></span><br><span class="line"><span class="regexp">         &lt;/</span>div&gt;</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="事件修饰符"><a href="#事件修饰符" class="headerlink" title="事件修饰符"></a>事件修饰符</h3><p>在基础部分简单介绍了事件的绑定用法，这里主要是补充一下事件修饰符的写法。</p>
<p>在模板语法中Vue提供了很多事件修饰符来快速处理事件的冒泡、捕获、事件触发频率、按键识别等。可以直接查看官方文档的<a href="https://cn.vuejs.org/v2/guide/render-function.html#事件-amp-按键修饰符" target="_blank" rel="noopener">事件&amp;按键修饰符</a>部分，这里把相关内容原样搬运过来：</p>
<table>
<thead>
<tr>
<th>修饰符</th>
<th>前缀</th>
</tr>
</thead>
<tbody><tr>
<td><code>.passive</code></td>
<td><code>&amp;</code></td>
</tr>
<tr>
<td><code>.capture</code></td>
<td><code>!</code></td>
</tr>
<tr>
<td><code>.once</code></td>
<td><code>~</code></td>
</tr>
<tr>
<td><code>.capture.once</code>或<code>.once.capture</code></td>
<td><code>~!</code></td>
</tr>
</tbody></table>
<p>使用方式如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-button &#123;...&#123;</span><br><span class="line">    <span class="string">'!click'</span>: <span class="keyword">this</span>.doThisInCapturingMode,</span><br><span class="line">  <span class="string">'!keyup'</span>: <span class="keyword">this</span>.doThisOnce,</span><br><span class="line">  <span class="string">'~!mouseover'</span>: <span class="keyword">this</span>.doThisOnceInCapturingMode</span><br><span class="line">&#125;&#125;&gt;Click Me!&lt;<span class="regexp">/el-button&gt;</span></span><br></pre></td></tr></table></figure>

<p>下面给出的事件修饰符是需要在事件处理函数中写出对应的等价操作</p>
<table>
<thead>
<tr>
<th>修饰符</th>
<th>处理函数中的等价操作</th>
</tr>
</thead>
<tbody><tr>
<td><code>.stop</code></td>
<td><code>event.stopPropagation()</code></td>
</tr>
<tr>
<td><code>.prevent</code></td>
<td><code>event.preventDefault()</code></td>
</tr>
<tr>
<td><code>.self</code></td>
<td><code>if (event.target !== event.currentTarget) return</code></td>
</tr>
<tr>
<td>按键： <code>.enter</code>, <code>.13</code></td>
<td><code>if (event.keyCode !== 13) return</code> (对于别的按键修饰符来说，可将 <code>13</code> 改为<a href="http://keycode.info/" target="_blank" rel="noopener">另一个按键码</a>)</td>
</tr>
<tr>
<td>修饰键： <code>.ctrl</code>, <code>.alt</code>, <code>.shift</code>, <code>.meta</code></td>
<td><code>if (!event.ctrlKey) return</code> (将 <code>ctrlKey</code> 分别修改为 <code>altKey</code>、<code>shiftKey</code> 或者 <code>metaKey</code>)</td>
</tr>
</tbody></table>
<p>下面是在事件处理函数中使用修饰符的例子：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">methods: &#123;</span><br><span class="line">  keyup(e) &#123;</span><br><span class="line">    <span class="comment">// 对应`.self`</span></span><br><span class="line">    <span class="keyword">if</span> (e.target !== e.currentTarget) <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 对应 `.enter`, `.13`</span></span><br><span class="line">    <span class="keyword">if</span> (!e.shiftKey || e.keyCode !== <span class="number">13</span>) <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 对应 `.stop`</span></span><br><span class="line">    e.stopPropagation()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 对应 `.prevent`</span></span><br><span class="line">    e.preventDefault()</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ref和refInFor"><a href="#ref和refInFor" class="headerlink" title="ref和refInFor"></a>ref和refInFor</h3><p>在Vue中<code>ref</code>被用来给元素或子组件注册引用信息。引用信息将会注册在父组件的 <code>$refs</code> 对象上。如果在普通的 DOM 元素上使用，引用指向的就是 DOM 元素；如果用在子组件上，引用就指向组件。</p>
<p><strong>注意</strong>：</p>
<ul>
<li>因为 ref 本身是作为渲染结果被创建的，在初始渲染的时候你不能访问它们 - 它们还不存在</li>
<li><code>$refs</code>不是响应式的，因此你不应该试图用它在模板中做数据绑定。</li>
</ul>
<p>当 <code>v-for</code> 用于元素或组件的时候，引用信息将是包含 DOM 节点或组件实例的数组。</p>
<p>假如在jsx中想要引用遍历元素或组件的时候，例如：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> LiArray = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.options.map(<span class="function"><span class="params">option</span> =&gt;</span> (</span><br><span class="line">  &lt;li ref=<span class="string">"li"</span> key=&#123;option&#125;&gt;&#123;option&#125;&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">))</span></span><br></pre></td></tr></table></figure>

<p>会发现从<code>this.$refs.li</code>中获取的并不是期望的数组值，这个时候就需要使用<code>refInFor</code>属性，并置为<code>true</code>来达到在模板中<code>v-for</code>中使用<code>ref</code>的效果：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> LiArray = <span class="function"><span class="params">()</span> =&gt;</span> <span class="keyword">this</span>.options.map(<span class="function"><span class="params">option</span> =&gt;</span> (</span><br><span class="line">  &lt;li ref=<span class="string">"li"</span> refInFor=&#123;<span class="literal">true</span>&#125; key=&#123;option&#125;&gt;&#123;option&#125;&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">))</span></span><br></pre></td></tr></table></figure>

<h3 id="插槽（v-slot"><a href="#插槽（v-slot" class="headerlink" title="插槽（v-slot)"></a>插槽（v-slot)</h3><p>在jsx中可以使用<code>this.$slots</code>来访问静态插槽的内容。</p>
<blockquote>
<p><strong>注意</strong>：在Vue 2.6.x版本后废弃了<code>slot</code>和<code>slot-scope</code>，在模板中统一使用新的统一语法<code>v-slot</code>指令。<code>v-slot</code>只能用于Vue组件和<code>template</code>标签。</p>
</blockquote>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"page-header__title"</span>&gt;</span><br><span class="line">    &#123;<span class="keyword">this</span>.$slots.title ? <span class="keyword">this</span>.$slots.title : <span class="keyword">this</span>.title&#125;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>

<p>等价于模板的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;page-header__title&quot;&gt;</span><br><span class="line">  &lt;slot name=&quot;title&quot;&gt;&#123;&#123; title &#125;&#125;&lt;/slot&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>在Vue官方文档中提到：<strong>父级模板里的所有内容都是在父级作用域中编译的；子模板里的所有内容都是在子作用域中编译的。</strong>因此像下面的示例是无法正常工作的</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;current-user&gt;</span><br><span class="line">    &#123;&#123; user.firstName &#125;&#125;</span><br><span class="line">&lt;<span class="regexp">/current-user&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;current-user&gt;</span><br><span class="line">    &#123;&#123; user.firstName &#125;&#125;</span><br><span class="line">&lt;<span class="regexp">/current-user&gt;</span></span><br></pre></td></tr></table></figure>

<p>在``组件中可以访问到<code>user</code>属性，但是提供的内容却是在父组件渲染的。如果想要达到期望的效果，这个时候就需要使用<strong>作用域插槽</strong>了。下面是改写后的代码，更多知识点可以直接查看官方文档的<a href="https://cn.vuejs.org/v2/guide/components-slots.html#作用域插槽" target="_blank" rel="noopener">作用域插槽</a>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- current-user组件定义部分 --&gt;</span><br><span class="line">&lt;span&gt;</span><br><span class="line">    &lt;slot v-bind:user=&quot;user&quot;&gt;</span><br><span class="line">      &#123;&#123; user.lastName &#125;&#125;</span><br><span class="line">  &lt;/slot&gt;</span><br><span class="line">&lt;/span&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- current-user 使用 --&gt;</span><br><span class="line">&lt;current-user&gt;</span><br><span class="line">    &lt;template v-slot:default=&quot;slotProps&quot;&gt;</span><br><span class="line">      &#123;&#123; slotProps.user.firstName &#125;&#125;</span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">&lt;/current-user&gt;</span><br></pre></td></tr></table></figure>

<p>上面的示例其实就是官方的示例，这里需要说明的是，其实在Vue中所谓的作用域插槽功能类似于React中的<strong>Render Props</strong>的概念，只不过在React中我们更多时候不仅提供了属性，还提供了操作方法。但是在Vue中更多的是提供数据供父作用域渲染展示，当然我们也可以把方法提供出去，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">    &lt;slot v-bind:injectedProps=&quot;slotProps&quot;&gt;</span><br><span class="line">      &#123;&#123; user.lastName &#125;&#125;</span><br><span class="line">      &lt;/slot&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">  export default &#123;</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        user: &#123;</span><br><span class="line">          firstName: &apos;snow&apos;,</span><br><span class="line">          lastName: &apos;wolf&apos;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    computed: &#123;</span><br><span class="line">      slotProps() &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">          user: this.user,</span><br><span class="line">          logFullName: this.logFullName</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br><span class="line">    methods: &#123;</span><br><span class="line">      logFullName() &#123;</span><br><span class="line">        console.log(`$&#123;this.firstName&#125; $&#123;this.lastName&#125;`)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>在父组件中使用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;current-user&gt;</span><br><span class="line">    &lt;template v-slot:default=&quot;&#123; injectedProps &#125;&quot;&gt;</span><br><span class="line">      &lt;div&gt;&#123;&#123; injectedProps.user.firstName &#125;&#125;&lt;/div&gt;</span><br><span class="line">        &lt;el-button @click=&quot;injectedProps.logFullName&quot;&gt;Log Full Name&lt;/el-button&gt;</span><br><span class="line">  &lt;/template&gt;</span><br><span class="line">&lt;/current-user&gt;</span><br></pre></td></tr></table></figure>

<p>在上面的代码中我们实际上使用解构的方式来取得<code>injectedProps</code>，基于解构的特性还可以重命名属性名，在<code>prop</code>为<code>undefined</code>的时候指定初始值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;current-user v-slot=&quot;&#123; user = &#123; firstName: &apos;Guest&apos; &#125; &#125;&quot;&gt;</span><br><span class="line">  &#123;&#123; user.firstName &#125;&#125;</span><br><span class="line">&lt;/current-user&gt;</span><br></pre></td></tr></table></figure>

<p>如果组件只有一个默认的插槽还可以使用缩写语法，将<code>v-slot:default=&quot;slotProps&quot;</code>写成<code>v-slot=&quot;slotProps&quot;</code>，命名插槽写成<code>v-slot:user=&quot;slotProps&quot;</code>，如果想要<strong>动态插槽名</strong>还可以写成<code>v-slot:[dynamicSlotName]</code>，此外<strong>具名插槽</strong>同样也有缩写语法，例如 <code>v-slot:header</code>可以被重写为<code>#header</code></p>
<p>上面介绍了很多插槽相关的知识点足已说明其在开发过程中的重要性。说了很多在模板中如何定义和使用作用域插槽，现在进入正题如何在jsx中同样使用呢？</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// current-user components</span></span><br><span class="line">&#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      user: &#123;</span><br><span class="line">        firstName: <span class="string">'snow'</span>,</span><br><span class="line">        lastName: <span class="string">'wolf'</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">    </span><br><span class="line">  computed: &#123;</span><br><span class="line">    slotProps() &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        user: <span class="keyword">this</span>.user,</span><br><span class="line">        logFullName: <span class="keyword">this</span>.logFullName</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">    </span><br><span class="line">  methods: &#123;</span><br><span class="line">    logFullName() &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">`<span class="subst">$&#123;<span class="keyword">this</span>.firstName&#125;</span> <span class="subst">$&#123;<span class="keyword">this</span>.lastName&#125;</span>`</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">    </span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">        &#123;<span class="keyword">this</span>.$scopedSlots.subTitle(&#123;</span><br><span class="line">          injectedProps: <span class="keyword">this</span>.slotProps</span><br><span class="line">        &#125;)&#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后在父组件中以jsx使用：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;current-user &#123;...&#123;</span><br><span class="line">  scopedSlots: &#123;</span><br><span class="line">    subTitle: <span class="function">(<span class="params">&#123; injectedProps &#125;</span>) =&gt;</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;h3&gt;injectedProps.user&lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp">        &lt;el-button onClick=&#123;injectedProps.logFullName&#125;&gt;Log Full Name&lt;/</span>el-button&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;&#125;&gt;&lt;/</span>current-user&gt;</span><br></pre></td></tr></table></figure>

<h3 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h3><p>这里需要注意的是在jsx中所有Vue内置的指令除了<code>v-show</code>以外都不支持，需要使用一些等价方式来实现，比如<code>v-if</code>使用三目运算表达式、<code>v-for</code>使用<code>array.map()</code>等。</p>
<p>对于自定义的指令可以使用<code>v-name={value}</code>的语法来写，需要注意的是指令的参数、修饰符此种方式并不支持。以官方文档指令部分给出的示例<code>v-focus</code>使用为例，介绍二种解决办法</p>
<p>1 <strong>直接使用对象传递所有指令属性</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type=&quot;text&quot; v-focus=&#123;&#123; value: true &#125;&#125; /&gt;</span><br></pre></td></tr></table></figure>

<p>2 <strong>使用原始的vnode指令数据格式</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  directives：&#123;</span><br><span class="line">    focus: &#123;</span><br><span class="line">      inserted: <span class="function"><span class="keyword">function</span>(<span class="params">el</span>) </span>&#123;</span><br><span class="line">        el.focus()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">    </span><br><span class="line">  render() &#123;</span><br><span class="line">    <span class="keyword">const</span> directives = [</span><br><span class="line">      &#123; <span class="attr">name</span>: <span class="string">'focus'</span>, <span class="attr">value</span>: <span class="literal">true</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">      </span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">          &lt;input type=<span class="string">"text"</span> &#123;...&#123; directives &#125;&#125; /&gt;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h3><p>过滤器其实在开发过程中用得倒是不多，因为<strong>更多时候可以通过计算属性来对数据做一些转换和筛选</strong>。这里只是简单提及一下并没有什么可以深究的知识点。</p>
<p>在模板中的用法如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 在双花括号中 --&gt;</span><br><span class="line">&#123;&#123; message | capitalize &#125;&#125;</span><br><span class="line"></span><br><span class="line">&lt;!-- 在 <span class="string">`v-bind`</span> 中 --&gt;</span><br><span class="line">&lt;div v-bind:id=<span class="string">"rawId | formatId"</span>&gt;&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>

<p>在jsx中使用方法为：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;&#123;<span class="keyword">this</span>.$options.filters(<span class="string">'formatDate'</span>)(<span class="string">'2019-07-01'</span>)&#125;&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：由于Vue全局的过滤器只用于模板中，如果需要用于组件的方法中，可以把过滤器方法单独抽离出一个公共Js文件，然后引入组件中，然后用于方法中。</p>
<h2 id="一些简单经验分享"><a href="#一些简单经验分享" class="headerlink" title="一些简单经验分享"></a>一些简单经验分享</h2><p>并不是说我们在开发Vue项目的时候一定要使用jsx的方式来写，但是多掌握一种方式来灵活变通，提高工作效率，扩展思路何尝不值得一试。而且，在有些场景下释放js的完全编程能力会让你更加能够得心应手。其实在使用模板方式的时候我们并没有完全采用组件的思维方式来做，或者说是做得不彻底，不纯粹，拆分的粒度不够。更多 的时候并没有考虑到组件怎么切分和抽象，多人协作的时候如何处理依赖并明确自己的功能点。</p>
<h3 id="关于DOM属性、HTML属性和组件属性"><a href="#关于DOM属性、HTML属性和组件属性" class="headerlink" title="关于DOM属性、HTML属性和组件属性"></a>关于DOM属性、HTML属性和组件属性</h3><p>在React中所有数据均挂载在<code>props</code>下，Vue则不然，仅属性就有三种：组件属性<code>props</code>，普通html属性<code>attrs</code>和DOM属性<code>domProps</code>。在Angular的文档中关于插值绑定部分是重点说明了<strong>DOM属性</strong>和<strong>HTML属性</strong>的区别，在大多数情况下两者都有对应的同名属性，也就是1:1映射关系，但是也有例外的情况，比如HTML中<code>colspan</code>，DOM中的<code>textContent</code>。HTML属性的值指定了初始值，并且不能改变，而DOM属性的值表示当前值，是可以改变的。</p>
<p>然后在Vue的模板语法中是不区分DOM属性和HTML属性的，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">    &lt;div&gt;输入的值：&#123;&#123; title &#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;input type=&quot;text&quot; value=&quot;我是DOM属性值&quot; v-model=&quot;title&quot; @input=&quot;logTitle&quot; /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">export default &#123;</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      title: &apos;&apos;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  </span><br><span class="line">  methods: &#123;</span><br><span class="line">    logTitle(e) &#123;</span><br><span class="line">      // 输出DOM属性</span><br><span class="line">      console.log(e.target.value)</span><br><span class="line">      // 输出HTML属性</span><br><span class="line">      console.log(e.target.getAttribue(&apos;value&apos;))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>运行示例可以看到<code>input</code>的初始值被设置为了“我是DOM属性值”，当我们在输入框中添加或者删除文字时，HTML属性始终没有变化，而绑定的DOM值一值在变动。然后再看一下在jsx中的实现：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;输入值：&#123; <span class="keyword">this</span>.title &#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">&lt;input type="text" value="我是DOM属性" v-model=&#123;this.title&#125; onInput=&#123;this.logTitle&#125; /</span>&gt;</span><br></pre></td></tr></table></figure>

<p>同样运行后会发现在jsx写法中并没有直接将HTML属性初始化为DOM属性值，即输入框中当前值为空字符串，这符合预期的行为。</p>
<p>此外在模板语法中是无法区分HTML属性和DOM属性命名一样的场景，但是在jsx中可以很好的区分：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Demo title=<span class="string">"我是组件属性"</span> domPropsTitle=<span class="string">"我是DOM属性"</span> /&gt;</span><br></pre></td></tr></table></figure>

<p>结果会就是在HMTL中显示<code>title=&quot;我是DOM属性</code>，而”我是组件属性”传递给了组件。</p>
<p>在React中CSS的样式写义在jsx中的语法是以<code>className=&quot;xx&quot;</code>的形式，而在Vue的jsx中可以直接写成<code>class=&quot;xx&quot;</code>。实际上由于<code>class</code>是Js的保留字，因此在DOM中其属性名为<code>className</code>而在HTML属性中为<code>class</code>，我们可以在Vue中这样写，经过Babel转译后得到正确的样式类名：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div domPropsClassName=<span class="string">"mt__xs"</span>&gt;&lt;<span class="regexp">/div&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>注意</strong>：如果同时写了<code>class=&quot;xx&quot; domPropsClassName=&quot;yy&quot;</code>那么后者的优先级较高，和位置无关。所以尽量还是采用<code>class</code>的写法。</p>
</blockquote>
<p>有使用过Bootstrap经验的可能会注意到它里面包含了很多<strong>ARIA</strong>属性，这些属性并不属于DOM，在jsx中可以通过<code>attrsXX</code>或者直接<code>aria-xx</code>的方式来添加:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;label aria-label=<span class="string">"title"</span>&gt;&lt;<span class="regexp">/label&gt;</span></span><br><span class="line"><span class="regexp">&lt;label attrsAria-label="title"&gt;&lt;/</span>label&gt;</span><br></pre></td></tr></table></figure>

<p>但是上面的换成<code>domPropsAria-label</code>就没有任何效果。</p>
<blockquote>
<p><strong>注意</strong>：在jsx中所有DOM属性(<strong>Property</strong>)语法为<code>domPropsXx</code>, HTML特性(<strong>Attribute</strong>)语法为<code>attrsXx</code>。更多的时候建议还是少使用，或者说合理使用。</p>
<p>在jsx中还可以使用混用的写法，例如在组件中写了``，还可以定义一个属性对象，然后使用<code>{...props}</code>的方式写在一起，这个时候就会出现属性合并的问题，同样的事件多个地方声明事件处理函数，都会触发。</p>
</blockquote>
<p>最后需要提及一点的是，在Vue中当给一个组件传了很多props，但是有的并不是组件声明的，也有可能是一些通用的HTML或者DOM属性，但是在最终编译后的HTML中会直接显示这些props，如果不希望这些属性显示在最终的HTML中，可以在组件中设<strong><code>inheritAttrs: false</code></strong>。虽然不显示了，但是我们依然可以通过<code>vm.$attrs</code>获取所有（除<code>class</code>和<code>style</code>)绑定的属性，包括不在props中定义的。</p>
<h3 id="关于事件"><a href="#关于事件" class="headerlink" title="关于事件"></a>关于事件</h3><p>前面已经把事件相关的知识点都介绍了，这里主要是提及一下关于jsx事件绑定语法<code>onXx</code>和组件属性（主要是函数prop)以<code>on</code>开头的情况如何处理。</p>
<p>虽然在写组件的时候可以避开命名以<code>on</code>开头，但是在使用第三库的时候，如果遇到了该如何处理呢？比如Element组件Upload很多钩子都是以<code>on</code>开头。 下面提供两种解决办法：</p>
<p>1.<strong>使用展开</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-upload &#123;...&#123;</span><br><span class="line">  props: &#123;</span><br><span class="line">    onPreview: <span class="keyword">this</span>.handlePreview</span><br><span class="line">  &#125;</span><br><span class="line">&#125;&#125; /&gt;</span><br></pre></td></tr></table></figure>

<p><strong>使用<code>propsXx</code></strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;el-upload propsOnPreview=&#123;<span class="keyword">this</span>.handlePreview&#125; /&gt;</span><br></pre></td></tr></table></figure>

<p>推荐使用第二种方式，写起来要简单些。</p>
<p><strong>实际使用中，发现这种写法不可行，而可行的方法是</strong></p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;CheckBox on-on-change /&gt;</span><br></pre></td></tr></table></figure>

<p>后边的 <code>on-change</code> 是 <code>CheckBox</code> 中通过 <code>$emit</code> 触发的事件名字，而前边的 <code>on</code> 是前缀</p>
<p>在使用<code>jsx</code>的时候，对于子组件内 <code>$emit</code> 触发的事件，可以在<code>jsx</code>文件内也就是父组件内通过 <code>on-</code>在子组件内定义的函数名字，其中，在子组件内定义的函数的名字如果是<code>-</code>相连的话，在父组件内接收也必须是<code>-</code>相连的形式</p>
<h3 id="复杂逻辑条件判断"><a href="#复杂逻辑条件判断" class="headerlink" title="复杂逻辑条件判断"></a>复杂逻辑条件判断</h3><p>在模板语法中可以使用<code>v-if</code>、<code>v-else-if</code>和<code>v-else</code>来做条件判断。在jsx中可以通过<code>?:</code>三元运算符(<strong>Ternary operator</strong>)运算符来做<code>if-else</code>判断：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> isTrue ? <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>True!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span> : <span class="literal">null</span></span><br></pre></td></tr></table></figure>

<p>然后可以利用<code>&amp;&amp;</code>运算符的特性简写为：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> isTrue &amp;&amp; <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>True!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>对于复杂的条件判断，例如：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &#123;flag &amp;&amp; flag2 &amp;&amp; !flag3</span><br><span class="line">        ? flag4</span><br><span class="line">         ? <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Blash<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">      : flag5</span><br><span class="line">         ? <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Meh<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">      : <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>hErp<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">        : <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Derp<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">    &#125;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure>

<p>可以采用两种方式来降低判断识别的复杂度</p>
<ul>
<li>最好的办法：将判断逻辑转移到子组件</li>
<li>可选的hacky方法：使用<strong>IIFE</strong>(立即执行表达式)</li>
<li>使用第三方库解决：<a href="https://github.com/AlexGilleran/jsx-control-statements" target="_blank" rel="noopener">jsx-control-statements</a></li>
</ul>
<p>下面是使用IIFE通过内部使用<code>if-else</code>返回值来优化上述问题：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      (<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (flag &amp;&amp; flag2 &amp;&amp;!flag3) &#123;</span><br><span class="line">          <span class="keyword">if</span> (flag4) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Blah<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">          &#125; <span class="keyword">else</span> <span class="keyword">if</span> (flag5) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Meh<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Herp<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Derp<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)()</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure>

<p>还可以使用<code>do</code>表达式，但是需要插件<strong>@babel/plugin-proposal-do-expressions</strong>的转译来支持，</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (flag1 &amp;&amp; flag2 &amp;&amp; !flag3) &#123;</span><br><span class="line">          <span class="keyword">if</span> (flag4) &#123;</span><br><span class="line">            &lt;p&gt;Blah&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">          &#125; else if (flag5) &#123;</span></span><br><span class="line"><span class="regexp">            &lt;p&gt;Meh&lt;/</span>p&gt;</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            &lt;p&gt;Herp&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">          &#125;</span></span><br><span class="line"><span class="regexp">        &#125; else &#123;</span></span><br><span class="line"><span class="regexp">          &lt;p&gt;Derp&lt;/</span>p&gt;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">)</span></span><br></pre></td></tr></table></figure>

<p>再就是一种比较简单的可选办法，如下：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Demo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> basicCondition = flag &amp;&amp; flag1 &amp;&amp; !flag3;</span><br><span class="line">  <span class="keyword">if</span> (!basicCondition) <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Derp<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="keyword">if</span> (flag4) <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Blah<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="keyword">if</span> (flag5) <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Meh<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">  <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Herp<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后一种使用jsx插件的就不详述和举例了，有兴趣的可以直接查看文档。</p>
<h3 id="组件的传值"><a href="#组件的传值" class="headerlink" title="组件的传值"></a>组件的传值</h3><p>在单个jsx文件中可以写很多函数式组件来切分更小的粒度，例如之前的文章<a href="https://segmentfault.com/a/1190000019457192" target="_blank" rel="noopener">Vue后台管理系统开发日常总结__组件PageHeader</a>，组件的形态有两种，一种是普通标题，另一种是带有选项卡的标题，那么在写的时候就可以这样写：</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* eslint-disable */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">    name: <span class="string">'n-header'</span>,</span><br><span class="line">    props: &#123;</span><br><span class="line">        isHeaderShow: &#123;</span><br><span class="line">            type: <span class="built_in">Boolean</span>,</span><br><span class="line">            <span class="keyword">default</span>: <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    render () &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> None = <span class="xml"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>空<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> Test = &#123;</span><br><span class="line">            render () &#123;</span><br><span class="line">                <span class="keyword">return</span> (</span><br><span class="line">                    &lt;h1&gt;测试&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">                )</span></span><br><span class="line"><span class="regexp">            &#125;</span></span><br><span class="line"><span class="regexp">        &#125;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">        return (</span></span><br><span class="line"><span class="regexp">            &lt;div&gt;</span></span><br><span class="line"><span class="regexp">                &#123; this.isHeaderShow ?  &lt;Test /</span>&gt; : None &#125;</span><br><span class="line">            &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        )</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure>

<p>函数式组件和 <code>html</code> 片段的用法如上</p>
<p>注意在拆分的时候，如果不需要做任何判断可以纯粹是HTML片段赋值给变量，如果需要条件判断就使用函数式组件的方式来写。<strong>需要注意的是由于<code>render</code>函数会多次被调用，写的时候注意一下对性能的影响，目前能力有限这方面就不作展开了。</strong></p>
<p>既然使用函数式组件，那么同样可以在函数中传递参数了，参数是一个对象中，包含了以下属性</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">children        # VNode数组，类似于React的children</span><br><span class="line">data          # 绑定的属性</span><br><span class="line">    attrs       # Attribute</span><br><span class="line">    domProps    # DOM property</span><br><span class="line">    on                # 事件</span><br><span class="line">injections  # 注入的对象</span><br><span class="line">listeners:  # 绑定的事件类型</span><br><span class="line">    click         # 点击事件</span><br><span class="line">    ...</span><br><span class="line">parent            # 父组件</span><br><span class="line">props                # 属性</span><br><span class="line">scopedSlots # 对象，作用域插槽，使用中发现作用域插槽也挂在这个下面</span><br><span class="line">slots                # 函数，插槽</span><br></pre></td></tr></table></figure>

<p>虽然可以在函数式组件中传参数、事件、slot但是个人觉得不建议这样做，反而搞复杂了。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">render() &#123;</span><br><span class="line">  <span class="keyword">const</span> Demo = <span class="function"><span class="params">props</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> (</span><br><span class="line">        &lt;div&gt;</span><br><span class="line">          &lt;h3&gt;Jsx中的内部组件 &#123; props.data.title &#125;&lt;<span class="regexp">/h3&gt;</span></span><br><span class="line"><span class="regexp">        &#123; props.children &#125;</span></span><br><span class="line"><span class="regexp">        &lt;br /</span>&gt;</span><br><span class="line">        &#123; props.scopedSlots.bar() &#125;</span><br><span class="line">      &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    )</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">  </span></span><br><span class="line"><span class="regexp">  return (</span></span><br><span class="line"><span class="regexp">      &lt;div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;Demo title="test" attrsA="a" domPropsB="b" onClick=&#123;this.demo&#125;&gt;</span></span><br><span class="line"><span class="regexp">          &lt;h3&gt;我是Children&lt;/</span>h3&gt;</span><br><span class="line">        &lt;template slot=<span class="string">"bar"</span>&gt;</span><br><span class="line">            &lt;p&gt;我是Slot内容&lt;<span class="regexp">/p&gt;</span></span><br><span class="line"><span class="regexp">        &lt;/</span>template&gt;</span><br><span class="line">      &lt;<span class="regexp">/Demo&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>div&gt;</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的示例最终生成的HTML中会将<code>的内容转换为</code>#document-fragment`。</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://niuxinyu.github.io/niuxinyublog/niuxinyublog/2020/06/27/vue-jsx-写法下的由于diff算法复用原则导致的表单验证问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Niu">
      <meta itemprop="description" content="文章">
      <meta itemprop="image" content="/niuxinyublog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niu的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/niuxinyublog/2020/06/27/vue-jsx-写法下的由于diff算法复用原则导致的表单验证问题/" class="post-title-link" itemprop="url">vue jsx 写法下的由于diff算法复用原则导致的表单验证问题</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2020-06-27 19:19:35 / 修改时间：22:30:44" itemprop="dateCreated datePublished" datetime="2020-06-27T19:19:35+08:00">2020-06-27</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="vue-jsx-写法下的由于diff算法复用原则导致的表单验证问题"><a href="#vue-jsx-写法下的由于diff算法复用原则导致的表单验证问题" class="headerlink" title="vue jsx 写法下的由于diff算法复用原则导致的表单验证问题"></a>vue jsx 写法下的由于diff算法复用原则导致的表单验证问题</h1><p>关于 <code>key</code> 的作用可以部分参考该文章 [参考地址](vue jsx 写法下的由于diff算法复用原则导致的表单验证问题)</p>
<p>出现问题的代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">import &#123; validateNormalInput &#125; from &apos;@/libs/tools&apos;</span><br><span class="line"></span><br><span class="line">export default &#123;</span><br><span class="line">    name: &apos;drawer-body&apos;,</span><br><span class="line">    props: &#123;</span><br><span class="line">        type: String,</span><br><span class="line">        params: Object</span><br><span class="line">    &#125;,</span><br><span class="line">    data () &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            formData: &#123;</span><br><span class="line">                attributeName: &apos;&apos;,</span><br><span class="line">                color: &apos;&apos;</span><br><span class="line">            &#125;,</span><br><span class="line">            modifyFormData: &#123;</span><br><span class="line">                // 修改案件属性</span><br><span class="line">                modifyAttributeCode: &apos;&apos;,</span><br><span class="line">                modifyAttributeName: &apos;&apos;,</span><br><span class="line">                modifyAddTime: &apos;&apos;,</span><br><span class="line">                modifyFontColor: &apos;&apos;</span><br><span class="line">            &#125;,</span><br><span class="line">            rules: &#123;</span><br><span class="line">                attributeName: [&#123; required: true, trigger: &apos;blur&apos;, validator: validateNormalInput, msg: &apos;属性名称&apos; &#125;]</span><br><span class="line">            &#125;,</span><br><span class="line">            modifyRules: &#123;</span><br><span class="line">                modifyAttributeCode: [&#123; required: true, trigger: &apos;blur&apos;, validator: validateNormalInput, msg: &apos;属性编码&apos; &#125;],</span><br><span class="line">                modifyAttributeName: [&#123; required: true, trigger: &apos;blur&apos;, validator: validateNormalInput, msg: &apos;属性名称&apos; &#125;]</span><br><span class="line">            &#125;,</span><br><span class="line">            currentModifyTableData: &#123;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        handleResetForm () &#123;</span><br><span class="line">            this.currentModifyTableData = &#123;&#125;</span><br><span class="line">            this._judge(&apos;resetFields&apos;)</span><br><span class="line">            this.$emit(&apos;close&apos;, false)</span><br><span class="line">        &#125;,</span><br><span class="line">        _judge (handler) &#123;</span><br><span class="line">            const type = this.type</span><br><span class="line">            return this.$refs[type][handler](valid =&gt; &#123;</span><br><span class="line">                return Promise.resolve(valid)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    watch: &#123;</span><br><span class="line">        params (newVal) &#123;</span><br><span class="line">            Object.assign(this.currentModifyTableData, newVal)</span><br><span class="line">            const &#123; row &#125; = this.currentModifyTableData</span><br><span class="line">            this.modifyFormData.modifyAttributeCode = row.attributeCode</span><br><span class="line">            this.modifyFormData.modifyAttributeName = row.attributeName</span><br><span class="line">            this.modifyFormData.modifyAddTime = row.addTime</span><br><span class="line">            this.modifyFormData.modifyFontColor = row.fontColor</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    render () &#123;</span><br><span class="line">        const caseForm = &lt;Form key=&apos;add&apos; ref=&apos;add&apos; props=&#123;&#123; model: this.formData &#125;&#125; rules=&#123;this.rules&#125;&gt;</span><br><span class="line">            &lt;FormItem label=&apos;属性名称&apos; prop=&apos;attributeName&apos;&gt;</span><br><span class="line">                &lt;Input vModel=&#123;this.formData.attributeName&#125; placeholder=&apos;请填写属性名称&apos;/&gt;</span><br><span class="line">            &lt;/FormItem&gt;</span><br><span class="line">            &lt;FormItem label=&apos;字体颜色&apos; prop=&apos;color&apos;&gt;</span><br><span class="line">                &lt;ColorPicker class=&apos;pl30&apos; vModel=&#123;this.formData.color&#125;/&gt;</span><br><span class="line">            &lt;/FormItem&gt;</span><br><span class="line">        &lt;/Form&gt;</span><br><span class="line">        const modifyForm = () =&gt; &#123;</span><br><span class="line">            return &lt;Form key=&apos;modify&apos; ref=&apos;modify&apos; props=&#123;&#123; model: this.modifyFormData &#125;&#125; rules=&#123;this.modifyRules&#125;&gt;</span><br><span class="line">                &lt;FormItem label=&apos;属性编码&apos; prop=&apos;modifyAttributeCode&apos;&gt;</span><br><span class="line">                    &lt;Input vModel=&#123;this.modifyFormData.modifyAttributeCode&#125;/&gt;</span><br><span class="line">                &lt;/FormItem&gt;</span><br><span class="line">                &lt;FormItem label=&apos;属性名称&apos; prop=&apos;modifyAttributeName&apos;&gt;</span><br><span class="line">                    &lt;Input vModel=&#123;this.modifyFormData.modifyAttributeName&#125;/&gt;</span><br><span class="line">                &lt;/FormItem&gt;</span><br><span class="line">                &lt;FormItem label=&apos;创建时间&apos; prop=&apos;modifyAddTime&apos;&gt;</span><br><span class="line">                    &lt;Input readonly vModel=&#123;this.modifyFormData.modifyAddTime&#125;/&gt;</span><br><span class="line">                &lt;/FormItem&gt;</span><br><span class="line">                &lt;FormItem label=&apos;字体颜色&apos; prop=&apos;modifyFontColor&apos;&gt;</span><br><span class="line">                    &lt;ColorPicker class=&apos;pl30&apos; disabled vModel=&#123;this.modifyFormData.modifyFontColor&#125;/&gt;</span><br><span class="line">                &lt;/FormItem&gt;</span><br><span class="line">            &lt;/Form&gt;</span><br><span class="line">        &#125;</span><br><span class="line">        const nForm = () =&gt; &#123;</span><br><span class="line">            const type = this.type</span><br><span class="line">            switch (type) &#123;</span><br><span class="line">                case &apos;add&apos;:</span><br><span class="line">                    return caseForm</span><br><span class="line">                case &apos;modify&apos;:</span><br><span class="line">                    return modifyForm()</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return (</span><br><span class="line">            &lt;div&gt;</span><br><span class="line">                &#123;nForm()&#125;</span><br><span class="line">                &lt;div class=&apos;n-center-title&apos;&gt;</span><br><span class="line">                    &lt;Button class=&apos;mr15&apos; onClick=&#123;this.handleResetForm&#125;&gt;取消&lt;/Button&gt;</span><br><span class="line">                    &lt;Button type=&apos;primary&apos;&gt;确认&lt;/Button&gt;</span><br><span class="line">                &lt;/div&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/niuxinyu/typoraimg/master/image-20200520100744142.png" alt="image-20200520100744142"></p>
<p><img src="https://raw.githubusercontent.com/niuxinyu/typoraimg/master/image-20200520100333044.png" alt="image-20200520100333044"></p>
<p><img src="https://raw.githubusercontent.com/niuxinyu/typoraimg/master/image-20200520100220630.png" alt="image-20200520100220630"></p>
<p>点击添加按钮之后，关闭侧边栏，之后再点击修改，会发现第二行表单的验证失效了，出现的原因初步认定是因为 <code>diff</code> 算法将 <code>dom</code> 元素就近复用导致的</p>
<p>问题</p>
<p><img src="https://raw.githubusercontent.com/niuxinyu/typoraimg/master/image-20200520095940616.png" alt="image-20200520095940616"></p>
<p>页面</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://niuxinyu.github.io/niuxinyublog/niuxinyublog/2020/06/27/vue-jsx-解决jsx下iview的Form组件绑定model报错的问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Niu">
      <meta itemprop="description" content="文章">
      <meta itemprop="image" content="/niuxinyublog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niu的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/niuxinyublog/2020/06/27/vue-jsx-解决jsx下iview的Form组件绑定model报错的问题/" class="post-title-link" itemprop="url">vue jsx 解决jsx下iview的Form组件绑定model报错的问题</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2020-06-27 19:18:50 / 修改时间：22:30:29" itemprop="dateCreated datePublished" datetime="2020-06-27T19:18:50+08:00">2020-06-27</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="解决jsx下iview的Form组件绑定model报错的问题"><a href="#解决jsx下iview的Form组件绑定model报错的问题" class="headerlink" title="解决jsx下iview的Form组件绑定model报错的问题"></a>解决jsx下iview的Form组件绑定model报错的问题</h1><p>在使用  <code>jsx</code> 写 <code>iview</code> 的 <code>Form</code> 组件的时候遇到了这样的一个错误</p>
<p><img src="https://raw.githubusercontent.com/niuxinyu/typoraimg/master/66759720-00c20d80-eecb-11e9-835e-85c80051a7c0.png" alt="屏幕快照 2019-10-14 下午9 37 16">    </p>
<p>代码如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">export default &#123;</span><br><span class="line">    name: &apos;n-form&apos;,</span><br><span class="line">    data () &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            formData: &#123;</span><br><span class="line">                name: &apos;&apos;</span><br><span class="line">            &#125;,</span><br><span class="line">            rules: &#123;</span><br><span class="line">                name: [....]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    render () &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;Form model=&#123;this.formData&#125; rules=&#123;this.rules&#125;&gt;</span><br><span class="line">                &lt;FormItem prop=&apos;name&apos;&gt;</span><br><span class="line">                  &lt;Input /&gt;</span><br><span class="line">                &lt;/FormItem&gt;</span><br><span class="line">            &lt;/FormF&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">export default &#123;</span><br><span class="line">    name: &apos;n-form&apos;,</span><br><span class="line">    data () &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            formData: &#123;</span><br><span class="line">                name: &apos;&apos;</span><br><span class="line">            &#125;,</span><br><span class="line">            rules: &#123;</span><br><span class="line">                name: [....]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    render () &#123;</span><br><span class="line">        return (</span><br><span class="line">            &lt;Form props=&#123;&#123;model: this.formData&#125;&#125; rules=&#123;this.rules&#125;&gt;</span><br><span class="line">                &lt;FormItem prop=&apos;name&apos;&gt;</span><br><span class="line">                  &lt;Input /&gt;</span><br><span class="line">                &lt;/FormItem&gt;</span><br><span class="line">            &lt;/FormF&gt;</span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/iview/iview/issues/6167" target="_blank" rel="noopener">参考地址</a></p>
<p>可以通过这个写法解决问题</p>
<p>经过 <code>google</code></p>
<p>这样写会一直报图片中的错误，并且验证时失效的</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://niuxinyu.github.io/niuxinyublog/niuxinyublog/2020/06/27/uniapp打包过程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Niu">
      <meta itemprop="description" content="文章">
      <meta itemprop="image" content="/niuxinyublog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niu的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/niuxinyublog/2020/06/27/uniapp打包过程/" class="post-title-link" itemprop="url">uniapp打包过程</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2020-06-27 19:07:30 / 修改时间：22:30:15" itemprop="dateCreated datePublished" datetime="2020-06-27T19:07:30+08:00">2020-06-27</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><code>uni app</code> 本地打包流程</p>
<ol>
<li><p>正常开发完毕之后，可以选择云端打包或者是本地打包</p>
<ol>
<li>云端打包没有啥可说的，直接在发行中选择 <code>原生App-云打包</code> 即可</li>
<li>本地打包的话，在 <code>发行--原生App-本地打包--生成本地打包App资源</code> </li>
</ol>
</li>
<li><p>打包完成之后需要在查看自己打包的 <code>wgt</code> 文件是多少版本的，之后需要在官网下载对应版本的 <code>SDK</code> <a href="https://ask.dcloud.net.cn/article/103" target="_blank" rel="noopener">https://ask.dcloud.net.cn/article/103</a></p>
<p>这一步非常重要，因为如果编译 <code>wgt</code> 版本和 <code>SDK</code> 版本不一致的话会出现各种各样的问题</p>
</li>
<li><p>下载完成之后在 <code>Android Studio</code> 中打开  <code>HBuilder-Hello</code> 项目</p>
<p><img src="https://raw.githubusercontent.com/niuxinyu/typoraimg/master/img/uni-app%E7%A4%BA%E4%BE%8B%E9%A1%B9%E7%9B%AE.png" alt="img"></p>
</li>
<li><p>然后将示例项目中的</p>
</li>
</ol>
<p><img src="https://raw.githubusercontent.com/niuxinyu/typoraimg/master/img/uni-app%20Android.png" alt="img"></p>
<p>将图中的文件夹删除掉  实例项目中应该是 <code>HelloH5</code> </p>
<p>替换为本地打包出来的资源</p>
<p><img src="https://github.com/niuxinyu/typoraimg/blob/master/img/uni-app%E6%9B%BF%E6%8D%A2.png?raw=true" alt="img"></p>
<ol>
<li>之后将如下的两个文件中改为一致</li>
</ol>
<p><img src="https://github.com/niuxinyu/typoraimg/blob/master/img/uni-app%E6%9B%B4%E6%94%B9appid.png?raw=true" alt="img"></p>
<ol>
<li>之后执行 <code>Android Studio</code> 中的 <code>Build</code> </li>
</ol>
<p><img src="https://github.com/niuxinyu/typoraimg/blob/master/img/uni-app%E6%89%93%E5%8C%85.png?raw=true" alt="img"></p>
<p>打包中遇到的坑记录</p>
<ol>
<li><code>SDK</code> 所在目录不能包含中文。</li>
</ol>
<p><img src="https://raw.githubusercontent.com/niuxinyu/typoraimg/master/img/uniapp%E6%89%93%E5%8C%85%E5%9D%91.png" alt="img"></p>
<p>这两个地方如果需要手动设置的话，格式要符合要求，并且两处需要保持一致。</p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
        <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block home">
    <link itemprop="mainEntityOfPage" href="https://niuxinyu.github.io/niuxinyublog/niuxinyublog/2020/06/27/uni-app问题记录/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Niu">
      <meta itemprop="description" content="文章">
      <meta itemprop="image" content="/niuxinyublog/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="niu的blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
            
            <a href="/niuxinyublog/2020/06/27/uni-app问题记录/" class="post-title-link" itemprop="url">uni-app问题记录</a>
          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2020-06-27 19:06:55 / 修改时间：22:28:25" itemprop="dateCreated datePublished" datetime="2020-06-27T19:06:55+08:00">2020-06-27</time>
            </span>
          
            

            
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="uni-app-开发中遇到的问题"><a href="#uni-app-开发中遇到的问题" class="headerlink" title="uni-app 开发中遇到的问题"></a><code>uni-app</code> 开发中遇到的问题</h1><h2 id="1-关于H5端接口跨域问题"><a href="#1-关于H5端接口跨域问题" class="headerlink" title="1. 关于H5端接口跨域问题"></a>1. 关于H5端接口跨域问题</h2><p>解决方法</p>
<p>配置 <code>manifest.json</code> 文件，在文件最后加上</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="attr">"name"</span>: <span class="string">"renderjs-echarts-demo"</span>,</span><br><span class="line">	<span class="attr">"appid"</span>: <span class="string">"__UNI__A90F8FC"</span>,</span><br><span class="line">	<span class="attr">"description"</span>: <span class="string">""</span>,</span><br><span class="line">	<span class="attr">"versionName"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">	<span class="attr">"versionCode"</span>: <span class="string">"100"</span>,</span><br><span class="line">	<span class="attr">"transformPx"</span>: <span class="literal">false</span>,</span><br><span class="line">	<span class="comment">/* 5+App特有相关 */</span></span><br><span class="line">	<span class="attr">"app-plus"</span>: &#123;</span><br><span class="line">		<span class="attr">"compatible"</span>: &#123;</span><br><span class="line">			<span class="attr">"ignoreVersion"</span>: <span class="literal">false</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">"usingComponents"</span>: <span class="literal">true</span>,</span><br><span class="line">		<span class="attr">"nvueCompiler"</span>: <span class="string">"uni-app"</span>,</span><br><span class="line">		<span class="attr">"splashscreen"</span>: &#123;</span><br><span class="line">			<span class="attr">"alwaysShowBeforeRender"</span>: <span class="literal">true</span>,</span><br><span class="line">			<span class="attr">"waiting"</span>: <span class="literal">true</span>,</span><br><span class="line">			<span class="attr">"autoclose"</span>: <span class="literal">true</span>,</span><br><span class="line">			<span class="attr">"delay"</span>: <span class="number">0</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="comment">/* 模块配置 */</span></span><br><span class="line">		<span class="attr">"modules"</span>: &#123;&#125;,</span><br><span class="line">		<span class="comment">/* 应用发布信息 */</span></span><br><span class="line">		<span class="attr">"distribute"</span>: &#123;</span><br><span class="line">			<span class="comment">/* android打包配置 */</span></span><br><span class="line">			<span class="attr">"android"</span>: &#123;</span><br><span class="line">				<span class="attr">"permissions"</span>: [</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.CHANGE_NETWORK_STATE\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.MOUNT_UNMOUNT_FILESYSTEMS\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.READ_CONTACTS\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.VIBRATE\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.READ_LOGS\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.ACCESS_WIFI_STATE\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-feature android:name=\"android.hardware.camera.autofocus\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.WRITE_CONTACTS\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.ACCESS_NETWORK_STATE\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.CAMERA\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.RECORD_AUDIO\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.GET_ACCOUNTS\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.MODIFY_AUDIO_SETTINGS\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.READ_PHONE_STATE\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.CHANGE_WIFI_STATE\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.WAKE_LOCK\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.CALL_PHONE\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.FLASHLIGHT\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.ACCESS_COARSE_LOCATION\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-feature android:name=\"android.hardware.camera\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.ACCESS_FINE_LOCATION\"/&gt;"</span>,</span><br><span class="line">					<span class="string">"&lt;uses-permission android:name=\"android.permission.WRITE_SETTINGS\"/&gt;"</span></span><br><span class="line">				]</span><br><span class="line">			&#125;,</span><br><span class="line">			<span class="comment">/* ios打包配置 */</span></span><br><span class="line">			<span class="attr">"ios"</span>: &#123;&#125;,</span><br><span class="line">			<span class="comment">/* SDK配置 */</span></span><br><span class="line">			<span class="attr">"sdkConfigs"</span>: &#123;</span><br><span class="line">				<span class="attr">"ad"</span>: &#123;&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">"compilerVersion"</span>: <span class="number">3</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="comment">/* 快应用特有相关 */</span></span><br><span class="line">	<span class="attr">"quickapp"</span>: &#123;&#125;,</span><br><span class="line">	<span class="comment">/* 小程序特有相关 */</span></span><br><span class="line">	<span class="attr">"mp-weixin"</span>: &#123;</span><br><span class="line">		<span class="attr">"appid"</span>: <span class="string">""</span>,</span><br><span class="line">		<span class="attr">"setting"</span>: &#123;</span><br><span class="line">			<span class="attr">"urlCheck"</span>: <span class="literal">false</span></span><br><span class="line">		&#125;,</span><br><span class="line">		<span class="attr">"usingComponents"</span>: <span class="literal">true</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"mp-alipay"</span>: &#123;</span><br><span class="line">		<span class="attr">"usingComponents"</span>: <span class="literal">true</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"mp-baidu"</span>: &#123;</span><br><span class="line">		<span class="attr">"usingComponents"</span>: <span class="literal">true</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"mp-toutiao"</span>: &#123;</span><br><span class="line">		<span class="attr">"usingComponents"</span>: <span class="literal">true</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">"h5"</span>: &#123;</span><br><span class="line">		<span class="attr">"devServer"</span>: &#123;</span><br><span class="line">			<span class="attr">"disableHostCheck"</span>: <span class="literal">true</span>,  <span class="comment">// 关闭host主机检查</span></span><br><span class="line">			<span class="attr">"proxy"</span>: &#123;</span><br><span class="line">				<span class="attr">"/api"</span>: &#123;</span><br><span class="line">					<span class="attr">"target"</span>: <span class="string">"http://192.168.0.113:8080"</span>,</span><br><span class="line">					<span class="attr">"changeOrigin"</span>: <span class="literal">true</span>,</span><br><span class="line">					<span class="attr">"secure"</span>: <span class="literal">false</span>,</span><br><span class="line">					<span class="attr">"pathRewrite"</span>: &#123;</span><br><span class="line">						<span class="attr">"^/api"</span>: <span class="string">""</span></span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="2-关于封装了-uni-request-方法导致的手机端接口请求失败的问题"><a href="#2-关于封装了-uni-request-方法导致的手机端接口请求失败的问题" class="headerlink" title="2. 关于封装了 uni.request() 方法导致的手机端接口请求失败的问题"></a>2. 关于封装了 <code>uni.request()</code> 方法导致的手机端接口请求失败的问题</h2><p><code>uni.request</code> 封装</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> config = <span class="built_in">Symbol</span>(<span class="string">'config'</span>)</span><br><span class="line"><span class="keyword">const</span> isCompleteURL = <span class="built_in">Symbol</span>(<span class="string">'isCompleteURL'</span>)</span><br><span class="line"><span class="keyword">const</span> requestBefore = <span class="built_in">Symbol</span>(<span class="string">'requestBefore'</span>)</span><br><span class="line"><span class="keyword">const</span> requestAfter = <span class="built_in">Symbol</span>(<span class="string">'requestAfter'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MinRequest</span> </span>&#123;</span><br><span class="line">	[config] = &#123;</span><br><span class="line">		baseURL: <span class="string">'http://192.168.0.113:8080'</span>,</span><br><span class="line">		header: &#123;</span><br><span class="line">			<span class="string">'content-type'</span>: <span class="string">'application/x-www-form-urlencoded'</span></span><br><span class="line">		&#125;,</span><br><span class="line">		method: <span class="string">'GET'</span>,</span><br><span class="line">		dataType: <span class="string">'json'</span>,</span><br><span class="line">		responseType: <span class="string">'text'</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 拦截器方法</span></span><br><span class="line">	interceptors = &#123;</span><br><span class="line">		request: <span class="function">(<span class="params">func</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (func) &#123;</span><br><span class="line">				MinRequest[requestBefore] = func</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				MinRequest[requestBefore] = <span class="function">(<span class="params">request</span>) =&gt;</span> request</span><br><span class="line">			&#125;</span><br><span class="line"></span><br><span class="line">		&#125;,</span><br><span class="line">		response: <span class="function">(<span class="params">func</span>) =&gt;</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (func) &#123;</span><br><span class="line">				MinRequest[requestAfter] = func</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				MinRequest[requestAfter] = <span class="function">(<span class="params">response</span>) =&gt;</span> response</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span>[requestBefore](config) &#123;</span><br><span class="line">		<span class="keyword">return</span> config</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span>[requestAfter](response) &#123;</span><br><span class="line">		<span class="keyword">return</span> response</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">static</span>[isCompleteURL](url) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="regexp">/(http|https):\/\/([\w.]+\/?)\S*/</span>.test(url)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	setConfig(func) &#123;</span><br><span class="line">		<span class="keyword">this</span>[config] = func(<span class="keyword">this</span>[config])</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	request(options = &#123;&#125;) &#123;</span><br><span class="line">		options.baseURL = options.baseURL || <span class="keyword">this</span>[config].baseURL</span><br><span class="line">		options.dataType = options.dataType || <span class="keyword">this</span>[config].dataType</span><br><span class="line">		<span class="comment">// options.url = MinRequest[isCompleteURL](options.url) ? options.url : (options.baseURL + options.url)</span></span><br><span class="line">		options.url = <span class="keyword">this</span>[config].baseURL + options.url</span><br><span class="line">		options.data = options.data</span><br><span class="line">		options.sslVerify = <span class="literal">false</span></span><br><span class="line">		options.header = &#123; ...options.header,</span><br><span class="line">			...this[config].header</span><br><span class="line">		&#125;</span><br><span class="line">		options.method = options.method || <span class="keyword">this</span>[config].method</span><br><span class="line"></span><br><span class="line">		options = &#123; ...options,</span><br><span class="line">			...MinRequest[requestBefore](options)</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="built_in">console</span>.log(options)</span><br><span class="line"></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">			options.success = <span class="function"><span class="keyword">function</span>(<span class="params">res</span>) </span>&#123;</span><br><span class="line">				resolve(MinRequest[requestAfter](res))</span><br><span class="line">			&#125;</span><br><span class="line">			options.fail = <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">				<span class="built_in">console</span>.log(err)</span><br><span class="line">				reject(MinRequest[requestAfter](err))</span><br><span class="line">			&#125;</span><br><span class="line">			uni.request(options)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">get</span>(params, options = &#123;&#125;) &#123;</span><br><span class="line">		options.url = params.url</span><br><span class="line">		options.data = params.data</span><br><span class="line">		options.method = <span class="string">'GET'</span></span><br><span class="line">		options.sslVerify = <span class="literal">false</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.request(options)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	post(params, options = &#123;&#125;) &#123;</span><br><span class="line">		options.url = params.url</span><br><span class="line">		options.data = params.data</span><br><span class="line">		options.method = <span class="string">'POST'</span></span><br><span class="line">		options.sslVerify = <span class="literal">false</span></span><br><span class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.request(options)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> MinRequest</span><br></pre></td></tr></table></figure>

<p>实例化</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> MinRequest <span class="keyword">from</span> <span class="string">'./http.js'</span></span><br><span class="line"><span class="keyword">import</span> config <span class="keyword">from</span> <span class="string">'../config'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> baseUrl = process.env.NODE_ENV === <span class="string">'development'</span> ? config.baseUrl.dev : config.baseUrl.pro</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> minRequest = <span class="keyword">new</span> MinRequest()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置默认配置</span></span><br><span class="line">minRequest.setConfig(<span class="function">(<span class="params">config</span>) =&gt;</span> &#123;</span><br><span class="line">  config.baseURL = baseUrl</span><br><span class="line">  <span class="keyword">return</span> config</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求拦截器</span></span><br><span class="line">minRequest.interceptors.request(<span class="function">(<span class="params">request</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> request</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line">minRequest.interceptors.response(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> response.data</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> minRequest</span><br></pre></td></tr></table></figure>

<p><code>config</code> 配置文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	 *  <span class="doctag">@description </span>请求的基础路径</span></span><br><span class="line"><span class="comment">	 * **/</span></span><br><span class="line">	baseUrl: &#123;</span><br><span class="line">		<span class="comment">// 开发环境下</span></span><br><span class="line">		<span class="comment">// #ifdef APP-PLUS</span></span><br><span class="line">		dev: <span class="string">'http://192.168.0.113:8080'</span>,</span><br><span class="line">		<span class="comment">// #endif</span></span><br><span class="line">		<span class="comment">// #ifdef H5</span></span><br><span class="line">		dev: <span class="string">''</span>,</span><br><span class="line">		<span class="comment">// #endif</span></span><br><span class="line">		<span class="comment">// 生产环境</span></span><br><span class="line">		pro: <span class="string">'http://192.168.0.113:8080'</span></span><br><span class="line">	&#125;,</span><br><span class="line">	BASE_PATH: <span class="string">'/api'</span></span><br><span class="line">	<span class="comment">// BASE_PATH: ''</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于App端是不存在跨域问题的，所以在实例化的时候实际上得到的基础路径是 <code>config</code> 文件下的 <code>dev</code> 路径，也就是空，所以导致了接口请求报错。</p>
<p><code>config</code> 文件修改后，根据条件编译区分不同平台以配置不同的请求基础路径。</p>
<h2 id="3-动态设置元素高度的问题"><a href="#3-动态设置元素高度的问题" class="headerlink" title="3. 动态设置元素高度的问题"></a>3. 动态设置元素高度的问题</h2><p>问题：由于开发供热  <code>app</code> 的时候需要动态的调整两个元素的高度为其中高度的较大值，但是 <code>app</code> 端是不支持 <code>dom</code> 操作的。</p>
<p>一开始的解决办法是：</p>
<blockquote>
<p>通过 <code>this.$refs.名字</code> 获得 <code>dom</code> 元素列表数组，然后通过 <code>this.$refs.名字.$el.clientHeighht</code> 得到高度并且进行对比，最后通过 <code>this.$refs.名字.style.height</code> 设置高度为两个高度中的较大值</p>
</blockquote>
<p>但是 <code>app</code> 端是不支持 <code>dom</code> 操作的。所以无法通过  <code>$refs</code> 设置其高度。</p>
<p>最终的解决办法是：</p>
<blockquote>
<p>纯数据驱动的解决办法</p>
</blockquote>
<p>在<code>watch</code> 中添加如下代码，<code>data</code> 中定义 如下, <code>methods</code> 中定义如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">					<span class="keyword">let</span> temp = []</span><br><span class="line">					<span class="keyword">let</span> header = uni.createSelectorQuery().selectAll(<span class="string">".table-vertical-header--cell"</span>)</span><br><span class="line">					<span class="keyword">let</span> body = uni.createSelectorQuery().selectAll(<span class="string">'.table-vertical-body--cell'</span>)</span><br><span class="line">					header.boundingClientRect(<span class="function"><span class="params">header</span> =&gt;</span> &#123;</span><br><span class="line">						body.boundingClientRect(<span class="function"><span class="params">body</span> =&gt;</span> &#123;</span><br><span class="line">							header.forEach(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">								<span class="keyword">if</span> (+item.height &gt;= +body[index].height) &#123;</span><br><span class="line">									<span class="keyword">this</span>.headerCellStyle.push(+item.height - <span class="number">20</span>)</span><br><span class="line">									<span class="keyword">this</span>.bodyCellStyle.push(+item.height - <span class="number">20</span>)</span><br><span class="line">								&#125;</span><br><span class="line">								<span class="keyword">else</span> &#123;</span><br><span class="line">									<span class="keyword">this</span>.headerCellStyle.push(+body[index].height - <span class="number">20</span>)</span><br><span class="line">									<span class="keyword">this</span>.bodyCellStyle.push(+body[index].height - <span class="number">20</span>)</span><br><span class="line">								&#125;</span><br><span class="line">							&#125;)</span><br><span class="line">						&#125;).exec()</span><br><span class="line">					&#125;).exec()</span><br><span class="line">				&#125;)</span><br><span class="line"></span><br><span class="line">data</span><br><span class="line">data () &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        headerCellStyle: [],</span><br><span class="line">        bodyCellStyle: []</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">methods</span><br><span class="line">methods: &#123;</span><br><span class="line">    getHeaderCellStyle (index) &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            height: <span class="keyword">this</span>.headerCellStyle[index] + <span class="string">'px'</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">        getBodyCellStyle (index) &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                height: <span class="keyword">this</span>.bodyCellStyle[index] + <span class="string">'px'</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后就可以使用了</p>
<h2 id="4-关于图片引入的问题"><a href="#4-关于图片引入的问题" class="headerlink" title="4. 关于图片引入的问题"></a>4. 关于图片引入的问题</h2><p>在 <code>uni-app</code> 中引入图片的时候，<code>require</code> 的形式引入的是 图片 <code>base64</code> 格式的图片。</p>
<p>有时候在手机端 <code>base64</code> 格式的图片可能会显示出问题，所以，在手机端可以使用 <code>绝对路径来引用问题</code></p>

        
      
    </div>

    
    
    
      <footer class="post-footer">
          <div class="post-eof"></div>
        
      </footer>
  </div>
  
  
  
  </article>

    
  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/niuxinyublog/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/niuxinyublog/page/8/">8</a><a class="extend next" rel="next" href="/niuxinyublog/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Niu</p>
  <div class="site-description" itemprop="description">文章</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/niuxinyublog/archives/">
        
          <span class="site-state-item-count">76</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
        <span class="site-state-item-count">13</span>
        <span class="site-state-item-name">标签</span>
        
      </div>
    
  </nav>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Niu</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.9.0</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.4.0</div>

        












        
      </div>
    </footer>
  </div>

  


  <script src="/niuxinyublog/lib/anime.min.js?v=3.1.0"></script>
  <script src="/niuxinyublog/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/niuxinyublog/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/niuxinyublog/js/utils.js?v=7.4.0"></script><script src="/niuxinyublog/js/motion.js?v=7.4.0"></script>
<script src="/niuxinyublog/js/schemes/pisces.js?v=7.4.0"></script>

<script src="/niuxinyublog/js/next-boot.js?v=7.4.0"></script>



  





















  

  

  

</body>
</html>
